<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Read-it Practice</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
min-height: 100vh;
display: flex;
justify-content: center;
align-items: center;
padding: 20px;
}

.container {
background: white;
border-radius: 30px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
max-width: 1000px;
width: 100%;
padding: 40px;
}

.header {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 30px;
border-radius: 20px;
text-align: center;
margin-bottom: 30px;
}

.header h1 {
font-size: 3em;
margin-bottom: 10px;
}

.header p {
font-size: 1.2em;
opacity: 0.9;
}

.setup-screen {
display: block;
}

.practice-screen {
display: none;
}

.section {
background: #f8f9fa;
border-radius: 20px;
padding: 30px;
margin: 20px 0;
}

.section h2 {
font-size: 2em;
color: #4c51bf;
margin-bottom: 20px;
}

.voice-selection {
display: flex;
gap: 20px;
margin: 20px 0;
}

.voice-option {
flex: 1;
background: white;
border: 3px solid #e0e0e0;
border-radius: 15px;
padding: 30px;
text-align: center;
cursor: pointer;
transition: all 0.3s;
}

.voice-option:hover {
transform: scale(1.05);
}

.voice-option.selected {
border-color: #667eea;
background: #ebf4ff;
}

.voice-icon {
font-size: 4em;
margin-bottom: 10px;
}

.voice-name {
font-size: 1.5em;
font-weight: bold;
color: #333;
}

.content-tabs {
display: flex;
gap: 10px;
margin-bottom: 20px;
}

.tab {
flex: 1;
background: white;
border: 2px solid #e0e0e0;
padding: 15px;
border-radius: 10px;
cursor: pointer;
text-align: center;
font-weight: bold;
transition: all 0.3s;
}

.tab:hover {
background: #f0f0f0;
}

.tab.active {
background: #667eea;
color: white;
border-color: #667eea;
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

.lesson-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 20px;
margin: 20px 0;
}

.lesson-card {
background: white;
border: 3px solid #e0e0e0;
border-radius: 15px;
padding: 20px;
cursor: pointer;
transition: all 0.3s;
}

.lesson-card:hover {
transform: translateY(-5px);
box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.lesson-card.selected {
border-color: #667eea;
background: #ebf4ff;
}

.lesson-icon {
font-size: 3em;
margin-bottom: 10px;
}

.lesson-title {
font-size: 1.3em;
font-weight: bold;
color: #333;
margin-bottom: 10px;
}

.lesson-duration {
color: #666;
font-size: 0.9em;
}

textarea {
width: 100%;
min-height: 200px;
padding: 20px;
border: 2px solid #e0e0e0;
border-radius: 15px;
font-size: 1.1em;
font-family: inherit;
resize: vertical;
}

.file-upload {
background: white;
border: 3px dashed #667eea;
border-radius: 15px;
padding: 40px;
text-align: center;
cursor: pointer;
transition: all 0.3s;
}

.file-upload:hover {
background: #f0f5ff;
}

.file-upload input {
display: none;
}

.file-name {
margin-top: 15px;
font-weight: bold;
color: #667eea;
}

.btn-primary {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
border: none;
padding: 20px 40px;
font-size: 1.5em;
font-weight: bold;
border-radius: 15px;
cursor: pointer;
width: 100%;
margin: 20px 0;
transition: transform 0.2s;
}

.btn-primary:hover:not(:disabled) {
transform: scale(1.05);
}

.btn-primary:disabled {
opacity: 0.6;
cursor: not-allowed;
}

.story-display {
background: #fff9e6;
border: 3px solid #ffc107;
border-radius: 15px;
padding: 30px;
margin: 20px 0;
font-size: 1.2em;
line-height: 1.8;
height: auto;
overflow: visible;
position: sticky;
top: 20px;
z-index: 100;
}

.story-display h3 {
color: #f57c00;
margin-bottom: 20px;
font-size: 1.5em;
}

#storyContent {
white-space: pre-wrap;
word-wrap: break-word;
}

.controls {
display: flex;
gap: 20px;
margin: 30px 0;
}

.btn-control {
flex: 1;
padding: 25px;
font-size: 1.5em;
font-weight: bold;
border-radius: 15px;
border: none;
cursor: pointer;
transition: all 0.3s;
}

.btn-start {
background: linear-gradient(135deg, #4caf50 0%, #2196f3 100%);
color: white;
}

.btn-stop {
background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
color: white;
}

.btn-control:hover:not(:disabled) {
transform: scale(1.05);
}

.btn-control:disabled {
opacity: 0.6;
cursor: not-allowed;
}

.recording-indicator {
background: #fee;
border: 3px solid #e74c3c;
border-radius: 15px;
padding: 20px;
text-align: center;
margin: 20px 0;
display: none;
}

.recording-indicator.active {
display: block;
animation: pulse 1.5s infinite;
}

@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.7; }
}

.recording-dot {
display: inline-block;
width: 15px;
height: 15px;
background: #e74c3c;
border-radius: 50%;
margin-right: 10px;
animation: blink 1s infinite;
}

@keyframes blink {
0%, 100% { opacity: 1; }
50% { opacity: 0; }
}

.results {
background: #e8f5e9;
border: 3px solid #4caf50;
border-radius: 15px;
padding: 30px;
margin: 20px 0;
display: none;
}

.results.show {
display: block;
}

.comparison-section {
background: white;
border-radius: 15px;
padding: 25px;
margin: 30px 0;
}

.comparison-section h3 {
color: #333;
margin-bottom: 20px;
font-size: 1.5em;
}

.text-comparison {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
margin: 20px 0;
}

.text-box {
background: #f8f9fa;
border-radius: 10px;
padding: 20px;
}

.text-box h4 {
color: #667eea;
margin-bottom: 15px;
font-size: 1.2em;
display: flex;
align-items: center;
gap: 10px;
}

.text-box-content {
font-size: 1.1em;
line-height: 1.8;
color: #333;
max-height: 300px;
overflow-y: auto;
}

.single-text-box {
grid-column: 1 / -1;
}

@media (max-width: 768px) {
.text-comparison {
grid-template-columns: 1fr;
}
}

.score-circle {
width: 200px;
height: 200px;
border-radius: 50%;
background: white;
border: 10px solid #4caf50;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
margin: 30px auto;
}

.score-value {
font-size: 3em;
font-weight: bold;
color: #4caf50;
}

.score-label {
font-size: 1.2em;
color: #666;
}

.accuracy-details {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
margin: 20px 0;
}

.stat-box {
background: white;
border-radius: 10px;
padding: 20px;
text-align: center;
}

.stat-value {
font-size: 2em;
font-weight: bold;
color: #667eea;
}

.stat-label {
color: #666;
margin-top: 5px;
}

.messages {
background: #f8f9fa;
border-radius: 15px;
padding: 20px;
margin: 20px 0;
max-height: 200px;
overflow-y: auto;
}

.message {
margin: 10px 0;
padding: 15px;
border-radius: 10px;
font-size: 1.1em;
}

.message.bot {
background: #e3f2fd;
color: #1976d2;
}

.hidden {
display: none;
}

.error-box {
background: #ffebee;
border: 3px solid #f44336;
border-radius: 15px;
padding: 20px;
margin: 20px 0;
color: #c62828;
}
</style>
</head>
<body>
<!-- Load PDF.js library from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
// Configure PDF.js worker
if (typeof pdfjsLib !== 'undefined') {
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
}
</script>
<!-- Load Mammoth.js library for Word documents -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

<div class="container">
<div class="header">
<h1>üìö Read-it Practice</h1>
<p>Improve your reading skills with AI-powered practice</p>
</div>

<!-- SETUP SCREEN -->
<div id="setupScreen" class="setup-screen">
<!-- Content Selection -->
<div class="section">
<h2>üìñ Choose Your Reading Material</h2>
<div class="content-tabs">
<div class="tab active" onclick="switchTab('lessons')">
üìö History Lessons
</div>
<div class="tab" onclick="switchTab('paste')">
‚úèÔ∏è Paste Text
</div>
<div class="tab" onclick="switchTab('upload')">
üìÑ Upload File
</div>
</div>

<!-- Lessons Tab -->
<div id="lessonsTab" class="tab-content active">
<div class="lesson-grid">
<div class="lesson-card" onclick="selectLesson(0)">
<div class="lesson-icon">üö¢</div>
<div class="lesson-title">The Mayflower Voyage</div>
<div class="lesson-duration">‚è±Ô∏è 2-3 minutes</div>
</div>
<div class="lesson-card" onclick="selectLesson(1)">
<div class="lesson-icon">üóΩ</div>
<div class="lesson-title">Declaration of Independence</div>
<div class="lesson-duration">‚è±Ô∏è 2-3 minutes</div>
</div>
<div class="lesson-card" onclick="selectLesson(2)">
<div class="lesson-icon">‚ö°</div>
<div class="lesson-title">The Industrial Revolution</div>
<div class="lesson-duration">‚è±Ô∏è 2-3 minutes</div>
</div>
</div>
</div>

<!-- Paste Tab -->
<div id="pasteTab" class="tab-content">
<textarea id="pasteText" placeholder="Paste your text here for reading practice..."></textarea>
</div>

<!-- Upload Tab -->
<div id="uploadTab" class="tab-content">
<div class="file-upload" onclick="document.getElementById('fileInput').click()">
<div style="font-size: 3em;">üìÅ</div>
<h3>Click to Upload File</h3>
<p>Supports .txt, .pdf, .doc, .docx files</p>
<input type="file" id="fileInput" accept=".txt,.pdf,.doc,.docx" onchange="handleFileUpload(event)">
<div id="fileName" class="file-name"></div>
</div>
<div id="fileError" class="hidden" style="color: #f44336; margin-top: 15px; text-align: center; font-weight: bold;"></div>
</div>
</div>

<div id="errorBox" class="error-box hidden"></div>

<button class="btn-primary" onclick="startPractice()">
üöÄ Start Reading Practice
</button>
</div>

<!-- PRACTICE SCREEN -->
<div id="practiceScreen" class="practice-screen">
<div class="messages" id="messages"></div>

<div class="story-display" id="storyDisplay">
<h3 id="storyTitle">Reading Passage</h3>
<div id="storyContent"></div>
</div>

<div class="recording-indicator" id="recordingIndicator">
<span class="recording-dot"></span>
<strong>üé§ Recording in progress... Speak clearly!</strong>
</div>

<div class="controls">
<button id="startBtn" class="btn-control btn-start" onclick="startRecording()">
üé§ Start Reading
</button>
<button id="stopBtn" class="btn-control btn-stop hidden" onclick="stopRecording()">
‚èπÔ∏è Stop Reading
</button>
</div>

<div id="results" class="results">
<h2 style="text-align: center; color: #4caf50; margin-bottom: 20px;">
üéâ Reading Results
</h2>
<div class="score-circle">
<div class="score-value" id="scoreValue">0%</div>
<div class="score-label">Accuracy</div>
</div>

<div style="text-align: center; margin: 20px 0; padding: 20px; background: white; border-radius: 15px;">
<p style="font-size: 1.2em; color: #666; line-height: 1.8;">
<strong>üìä What is Accuracy?</strong><br>
Accuracy shows how closely your reading matched the original text. 
It compares each word you spoke with the correct words in the passage. 
A higher percentage means you read more words correctly!
</p>
</div>

<div class="comparison-section">
<h3>üé§ What You Read</h3>
<div class="text-box single-text-box">
<div class="text-box-content" id="userRecordedText">
Your recorded text will appear here...
</div>
</div>
</div>

<button class="btn-primary" onclick="resetPractice()">
üîÑ Try Another Practice
</button>
</div>
</div>
</div>

<script>
// State
let selectedVoice = 'female'; // Default to female voice
let selectedContent = null;
let recognition = null;
let isRecording = false;
let recordedTranscript = '';

const lessons = [
{
title: "The Mayflower Voyage",
text: "In September 1620, a small ship called the Mayflower set sail from England. Aboard were 102 passengers seeking religious freedom and a new life in America. The journey across the Atlantic Ocean was treacherous, lasting 66 days through storms and rough seas. Many passengers became sick during the voyage. When they finally reached the shores of what is now Massachusetts, they faced a harsh winter. Nearly half of the passengers did not survive. But those who remained persevered, establishing Plymouth Colony. They formed a agreement called the Mayflower Compact, creating a foundation for self-governance. With help from Native Americans, particularly Squanto, they learned to grow crops and hunt. Their first successful harvest led to a celebration of thanksgiving. This small group of determined settlers became known as the Pilgrims, and their courage helped shape the future of America."
},
{
title: "Declaration of Independence",
text: "In the summer of 1776, thirteen American colonies stood at a crossroads. For years, they had been under British rule, paying taxes without representation in Parliament. Tensions had been building, and conflict seemed inevitable. A group of colonial leaders gathered in Philadelphia for the Continental Congress. They faced a momentous decision: should they declare independence from Britain? Thomas Jefferson, a young lawyer from Virginia, was chosen to draft a document. Working late into the nights, he wrote words that would echo through history. He declared that all men are created equal and have unalienable rights to life, liberty, and the pursuit of happiness. On July 4, 1776, the Congress adopted the Declaration of Independence. It was a bold and dangerous move, as it meant war with the most powerful nation on Earth. But the founders believed in their cause. They signed their names, knowing they could be executed for treason. Their courage gave birth to a new nation."
},
{
title: "The Industrial Revolution",
text: "In the late 1700s, America began to transform from a farming society into an industrial powerhouse. This period, known as the Industrial Revolution, changed every aspect of American life. It began in England with new inventions like the steam engine and spinning jenny. These innovations soon crossed the Atlantic to America. Samuel Slater, often called the Father of the American Industrial Revolution, built the first textile mill in Rhode Island. Factories began appearing along rivers, using water power to run machines. People left their farms to work in cities. The invention of the cotton gin by Eli Whitney revolutionized cotton production in the South. Railroads expanded across the nation, connecting distant cities and enabling trade. Factories produced goods faster and cheaper than ever before. However, this progress came at a cost. Workers, including children, labored long hours in dangerous conditions. Cities became crowded and polluted. Yet the Industrial Revolution laid the foundation for American economic power and changed the nation forever."
}
];

// Voice Selection
function selectVoice(voice) {
selectedVoice = voice;
document.querySelectorAll('.voice-option').forEach(opt => {
opt.classList.remove('selected');
});
document.querySelector(`[data-voice="${voice}"]`).classList.add('selected');
}

// Tab Switching
function switchTab(tab) {
document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
event.target.classList.add('active');
document.getElementById(tab + 'Tab').classList.add('active');
}

// Lesson Selection
function selectLesson(index) {
selectedContent = lessons[index];
document.querySelectorAll('.lesson-card').forEach(card => {
card.classList.remove('selected');
});
event.target.closest('.lesson-card').classList.add('selected');
}

// File Upload with support for PDF, Word, and Text files
function handleFileUpload(event) {
const file = event.target.files[0];
const fileError = document.getElementById('fileError');
const fileName = document.getElementById('fileName');
fileError.classList.add('hidden');
fileName.textContent = '';

if (!file) return;

const fileType = file.type;
const fileExtension = file.name.split('.').pop().toLowerCase();

// Handle Text Files
if (fileType === 'text/plain' || fileExtension === 'txt') {
const reader = new FileReader();
reader.onload = function(e) {
selectedContent = {
title: file.name.replace('.txt', ''),
text: e.target.result
};
fileName.textContent = `‚úÖ ${file.name} loaded successfully`;
};
reader.onerror = function() {
fileError.textContent = '‚ùå Error reading text file. Please try again.';
fileError.classList.remove('hidden');
};
reader.readAsText(file);
}
// Handle PDF Files
else if (fileType === 'application/pdf' || fileExtension === 'pdf') {
fileName.textContent = `‚è≥ Loading ${file.name}...`;
const reader = new FileReader();
reader.onload = async function(e) {
try {
// Use PDF.js library (loaded from CDN)
const loadingTask = pdfjsLib.getDocument({data: e.target.result});
const pdf = await loadingTask.promise;
let fullText = '';

// Extract text from all pages
for (let i = 1; i <= pdf.numPages; i++) {
const page = await pdf.getPage(i);
const textContent = await page.getTextContent();
const pageText = textContent.items.map(item => item.str).join(' ');
fullText += pageText + ' ';
}

if (fullText.trim()) {
selectedContent = {
title: file.name.replace('.pdf', ''),
text: fullText.trim()
};
fileName.textContent = `‚úÖ ${file.name} loaded successfully`;
} else {
fileError.textContent = '‚ùå No text found in PDF. Please try a different file.';
fileError.classList.remove('hidden');
}
} catch (error) {
console.error('PDF Error:', error);
fileError.textContent = '‚ùå Error reading PDF file. Please try again.';
fileError.classList.remove('hidden');
}
};
reader.onerror = function() {
fileError.textContent = '‚ùå Error reading PDF file. Please try again.';
fileError.classList.remove('hidden');
};
reader.readAsArrayBuffer(file);
}
// Handle Word Documents (.doc, .docx)
else if (fileType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || 
fileExtension === 'docx' || fileExtension === 'doc') {
fileName.textContent = `‚è≥ Loading ${file.name}...`;
const reader = new FileReader();
reader.onload = async function(e) {
try {
// Use mammoth.js library for Word documents
const result = await mammoth.extractRawText({arrayBuffer: e.target.result});
const text = result.value;

if (text.trim()) {
selectedContent = {
title: file.name.replace(/\.(docx|doc)$/, ''),
text: text.trim()
};
fileName.textContent = `‚úÖ ${file.name} loaded successfully`;
} else {
fileError.textContent = '‚ùå No text found in document. Please try a different file.';
fileError.classList.remove('hidden');
}
} catch (error) {
console.error('Word Document Error:', error);
fileError.textContent = '‚ùå Error reading Word document. Please try again.';
fileError.classList.remove('hidden');
}
};
reader.onerror = function() {
fileError.textContent = '‚ùå Error reading Word document. Please try again.';
fileError.classList.remove('hidden');
};
reader.readAsArrayBuffer(file);
}
else {
fileError.textContent = '‚ùå Unsupported file type. Please upload .txt, .pdf, .doc, or .docx files.';
fileError.classList.remove('hidden');
}
}

// Start Practice
async function startPractice() {
const errorBox = document.getElementById('errorBox');
errorBox.classList.add('hidden');

// Validate content selection
const pasteText = document.getElementById('pasteText').value.trim();
if (pasteText) {
selectedContent = {
title: 'Your Custom Text',
text: pasteText
};
}

if (!selectedContent) {
errorBox.textContent = '‚ö†Ô∏è Please select a lesson, paste text, or upload a file';
errorBox.classList.remove('hidden');
return;
}

// Request microphone permission
try {
const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
stream.getTracks().forEach(track => track.stop());
} catch (error) {
errorBox.textContent = '‚ùå Microphone access denied. Please allow microphone access in your browser settings.';
errorBox.classList.remove('hidden');
return;
}

// Initialize speech recognition
if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
errorBox.textContent = '‚ùå Speech recognition not supported. Please use Chrome, Edge, or Safari.';
errorBox.classList.remove('hidden');
return;
}

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
recognition = new SpeechRecognition();
recognition.continuous = true;
recognition.interimResults = true;
recognition.lang = 'en-US';

recognition.onresult = (event) => {
for (let i = event.resultIndex; i < event.results.length; i++) {
if (event.results[i].isFinal) {
recordedTranscript += event.results[i][0].transcript + ' ';
}
}
};

recognition.onerror = (event) => {
if (event.error !== 'no-speech' && event.error !== 'aborted') {
console.error('Recognition error:', event.error);
}
};

// Switch to practice screen
document.getElementById('setupScreen').style.display = 'none';
document.getElementById('practiceScreen').style.display = 'block';

// Display content
document.getElementById('storyTitle').textContent = selectedContent.title;
document.getElementById('storyContent').textContent = selectedContent.text;

// Give instructions
addMessage('üëã Welcome to Read-it Practice! I\'m your reading coach.');
setTimeout(() => addMessage(`üéØ Today you'll be practicing: "${selectedContent.title}"`), 500);
setTimeout(() => addMessage('üìñ Here\'s how it works: I\'ll read the passage to you first, then it\'s your turn to read it back to me.'), 1000);
setTimeout(() => addMessage('üé§ When you\'re ready to read, click "Start Reading". When you finish, click "Stop Reading".'), 1500);
setTimeout(() => addMessage('üíØ I\'ll give you a score based on your accuracy. Let\'s begin!'), 2000);
setTimeout(() => {
addMessage('üîä Listen carefully as I read the passage...');
speakText(selectedContent.text);
}, 2500);

setTimeout(() => {
addMessage('‚úÖ Now it\'s your turn! Click "Start Reading" when you\'re ready.');
}, calculateReadTime(selectedContent.text) + 3000);
}

// Text to Speech with proper voice selection
function speakText(text) {
if ('speechSynthesis' in window) {
window.speechSynthesis.cancel();
const utterance = new SpeechSynthesisUtterance(text);

// Get available voices
const voices = window.speechSynthesis.getVoices();

// Set voice based on selection with multiple fallback options
if (selectedVoice === 'male') {
// Try to find male voices in order of preference
const maleVoice = voices.find(v => 
v.name.includes('Male') || 
v.name.includes('David') || 
v.name.includes('Mark') ||
v.name.includes('Daniel') ||
v.name.includes('James') ||
(v.name.includes('Google') && v.name.includes('US') && !v.name.includes('Female'))
);
if (maleVoice) {
utterance.voice = maleVoice;
console.log('Selected male voice:', maleVoice.name);
}
} else if (selectedVoice === 'female') {
// Try to find female voices in order of preference
const femaleVoice = voices.find(v => 
v.name.includes('Female') || 
v.name.includes('Samantha') || 
v.name.includes('Victoria') ||
v.name.includes('Karen') ||
v.name.includes('Moira') ||
v.name.includes('Fiona') ||
v.name.includes('Susan') ||
(v.name.includes('Google') && v.name.includes('US') && v.name.includes('Female'))
);
if (femaleVoice) {
utterance.voice = femaleVoice;
console.log('Selected female voice:', femaleVoice.name);
} else {
// If no explicit female voice found, use default (which is often female)
console.log('Using default voice (often female)');
}
}
 
utterance.rate = 0.85;
utterance.pitch = 1;
utterance.volume = 1;
window.speechSynthesis.speak(utterance);
}
}

// Calculate reading time
function calculateReadTime(text) {
const words = text.split(/\s+/).length;
const wordsPerMinute = 150;
return (words / wordsPerMinute) * 60 * 1000;
}

// Add Message
function addMessage(text) {
const messages = document.getElementById('messages');
const messageDiv = document.createElement('div');
messageDiv.className = 'message bot';
messageDiv.textContent = text;
messages.appendChild(messageDiv);
messages.scrollTop = messages.scrollHeight;
}

// Start Recording
function startRecording() {
if (recognition && !isRecording) {
recordedTranscript = '';
isRecording = true;
recognition.start();
document.getElementById('startBtn').classList.add('hidden');
document.getElementById('stopBtn').classList.remove('hidden');
document.getElementById('recordingIndicator').classList.add('active');
addMessage('üé§ Recording started! Read the passage above.');
}
}

// Stop Recording
function stopRecording() {
if (recognition && isRecording) {
isRecording = false;
recognition.stop();
document.getElementById('startBtn').classList.remove('hidden');
document.getElementById('stopBtn').classList.add('hidden');
document.getElementById('recordingIndicator').classList.remove('active');
addMessage('‚èπÔ∏è Recording stopped. Analyzing your reading...');
setTimeout(() => analyzeReading(), 1000);
}
}

// Analyze Reading
function analyzeReading() {
const userText = recordedTranscript.trim();
const originalText = selectedContent.text;

if (!userText) {
addMessage('‚ùå No speech detected. Please try again and speak louder.');
return;
}

// Display only the recorded text
document.getElementById('userRecordedText').textContent = userText;

// Calculate accuracy
const originalWords = originalText.toLowerCase().split(/\s+/);
const userWords = userText.toLowerCase().split(/\s+/);
const minLength = Math.min(originalWords.length, userWords.length);

let correctWords = 0;
for (let i = 0; i < minLength; i++) {
const origWord = originalWords[i].replace(/[.,!?;:]/g, '');
const userWord = userWords[i].replace(/[.,!?;:]/g, '');
if (origWord === userWord) {
correctWords++;
}
}

const accuracy = Math.round((correctWords / originalWords.length) * 100);

// Display results - only accuracy percentage
document.getElementById('scoreValue').textContent = accuracy + '%';
document.getElementById('results').classList.add('show');

// Update score circle color
const circle = document.querySelector('.score-circle');
const scoreValue = document.querySelector('.score-value');
if (accuracy >= 90) {
circle.style.borderColor = '#4caf50';
scoreValue.style.color = '#4caf50';
addMessage('üåü Excellent! Outstanding reading accuracy!');
speakText(`Excellent job! You scored ${accuracy} percent accuracy. Your reading was outstanding!`);
} else if (accuracy >= 70) {
circle.style.borderColor = '#ff9800';
scoreValue.style.color = '#ff9800';
addMessage('üëç Good job! Keep practicing to improve further.');
speakText(`Good job! You scored ${accuracy} percent accuracy. Keep practicing!`);
} else {
circle.style.borderColor = '#f44336';
scoreValue.style.color = '#f44336';
addMessage('üí™ Keep practicing! You\'re on the right track.');
speakText(`You scored ${accuracy} percent accuracy. Keep practicing and you'll improve!`);
}
}

// Reset Practice
function resetPractice() {
window.location.reload();
}

// Load voices when available and log them for debugging
if ('speechSynthesis' in window) {
// Load voices initially
setTimeout(() => {
const voices = window.speechSynthesis.getVoices();
console.log('Available voices:', voices.map(v => v.name));
}, 100);

// Also load when voices change (some browsers need this)
window.speechSynthesis.onvoiceschanged = () => {
const voices = window.speechSynthesis.getVoices();
console.log('Voices loaded:', voices.map(v => v.name));
};
}
</script>
</body>
</html>