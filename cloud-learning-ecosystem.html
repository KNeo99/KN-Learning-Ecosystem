<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KN Cloud Learning Ecosystem</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Panel 1: Chat */
        .chat-panel {
            width: 66.666%;
            background: white;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
        }

        .chat-header {
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 50%, #7c3aed 100%);
            color: white;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chat-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .chat-icon {
            font-size: 2rem;
        }

        .chat-title h1 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .chat-subtitle {
            font-size: 0.875rem;
            color: #dbeafe;
        }

        .platform-badge {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
        }

        .platform-badge.active {
            display: block;
        }

        .platform-badge.aws {
            background: linear-gradient(135deg, #f97316 0%, #eab308 100%);
        }

        .platform-badge.gcp {
            background: linear-gradient(135deg, #3b82f6 0%, #10b981 100%);
        }

        .platform-badge.azure {
            background: linear-gradient(135deg, #2563eb 0%, #06b6d4 100%);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            margin-bottom: 1rem;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.ai {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 75%;
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }

        .message.ai .message-content {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            color: #1f2937;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-bottom-left-radius: 0.25rem;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.5rem;
            display: block;
        }

        .quick-actions {
            padding: 0.75rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #f9fafb 0%, #dbeafe 100%);
        }

        .quick-actions-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: #dbeafe;
            border-color: #93c5fd;
        }

        .quick-btn.example {
            background: linear-gradient(135deg, #7c3aed 0%, #ec4899 100%);
            color: white;
            border: none;
        }

        .quick-btn.example:hover {
            opacity: 0.9;
        }

        .input-area {
            padding: 1.5rem;
            border-top: 2px solid #e5e7eb;
            background: white;
        }

        .recording-indicator {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
            animation: pulse 2s infinite;
        }

        .recording-indicator.active {
            display: flex;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .recording-dot {
            width: 0.75rem;
            height: 0.75rem;
            background: #ef4444;
            border-radius: 50%;
        }

        .recording-text {
            color: #991b1b;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .speaking-indicator {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: #eff6ff;
            border: 1px solid #93c5fd;
            border-radius: 0.5rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
            animation: pulse 2s infinite;
        }

        .speaking-indicator.active {
            display: flex;
        }

        .speaking-dot {
            width: 0.75rem;
            height: 0.75rem;
            background: #3b82f6;
            border-radius: 50%;
        }

        .speaking-text {
            color: #1e40af;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .voice-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 0.5rem;
            border: 1px solid #86efac;
        }

        .voice-toggle {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 1px solid #22c55e;
            border-radius: 0.5rem;
            background: white;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .voice-toggle:hover {
            background: #f0fdf4;
        }

        .voice-toggle.active {
            background: #22c55e;
            color: white;
            border-color: #16a34a;
        }

        .voice-status {
            font-size: 0.75rem;
            color: #15803d;
            text-align: center;
        }

        .input-controls {
            display: flex;
            gap: 0.75rem;
        }

        .mic-button {
            padding: 1rem;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
        }

        .mic-button:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .mic-button.recording {
            background: #ef4444;
            animation: pulse 2s infinite;
        }

        .input-group {
            flex: 1;
            display: flex;
            gap: 0.75rem;
        }

        .text-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .text-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .send-button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #2563eb 0%, #4f46e5 50%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .send-button:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        /* Panel 2: Dashboard */
        .dashboard-panel {
            width: 33.333%;
            background: linear-gradient(180deg, #4f46e5 0%, #7c3aed 50%, #ec4899 100%);
            color: white;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .dashboard-header {
            margin-bottom: 1.5rem;
        }

        .dashboard-header h2 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dashboard-subtitle {
            font-size: 0.875rem;
            color: #e0d5f7;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .card-icon {
            font-size: 1.25rem;
        }

        .card-title {
            font-weight: bold;
            font-size: 1.125rem;
        }

        .current-lesson-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #fde047;
            margin-bottom: 0.5rem;
        }

        .current-lesson-concept {
            font-size: 0.875rem;
            color: #e0d5f7;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .current-lesson-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .platform-display {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .platform-icon {
            font-size: 2.5rem;
        }

        .platform-name {
            font-weight: bold;
            font-size: 1.125rem;
        }

        .platform-subtitle {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .progress-percentage {
            font-size: 0.875rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: bold;
        }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 9999px;
            height: 0.75rem;
            margin-bottom: 1rem;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar-fill {
            background: linear-gradient(90deg, #4ade80 0%, #10b981 50%, #14b8a6 100%);
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }

        .streak-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .streak-badge {
            background: linear-gradient(135deg, #f97316 0%, #ef4444 100%);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: bold;
            font-size: 0.875rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .flashcard-container {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
            min-height: 200px;
        }

        .flashcard-container:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .flashcard-flip-label {
            font-size: 0.75rem;
            color: #6366f1;
            font-style: italic;
            margin-left: 0.5rem;
        }

        .flashcard-front, .flashcard-back {
            min-height: 140px;
        }

        .flashcard-question {
            color: #2563eb;
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .flashcard-answer {
            color: #4b5563;
            font-size: 0.9375rem;
            line-height: 1.6;
        }

        .flashcard-hint {
            text-align: center;
            color: #9ca3af;
            font-size: 0.75rem;
            margin-top: 1rem;
        }

        .flashcard-back {
            display: none;
        }

        .flashcard-container.flipped .flashcard-front {
            display: none;
        }

        .flashcard-container.flipped .flashcard-back {
            display: block;
        }

        .resources-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .resource-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }

        .resource-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateX(4px);
        }

        .resource-title {
            font-weight: 600;
            color: #67e8f9;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .resource-link {
            color: #67e8f9;
            text-decoration: none;
        }

        .resource-link:hover {
            text-decoration: underline;
        }

        .resource-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
        }

        .resource-type {
            display: inline-block;
            background: rgba(103, 232, 249, 0.2);
            color: #67e8f9;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.625rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .tools-grid {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .tool-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tool-name {
            font-weight: 600;
            color: #67e8f9;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .tool-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .course-map {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .lesson-item {
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .lesson-item.current {
            background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
            border: 2px solid white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .lesson-item.completed {
            background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
            border: 1px solid #6ee7b7;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .lesson-item.locked {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .lesson-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .lesson-number {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .lesson-item.current .lesson-number {
            background: white;
            color: #2563eb;
        }

        .lesson-item.completed .lesson-number {
            background: white;
            color: #10b981;
        }

        .lesson-item.locked .lesson-number {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.125rem;
        }

        .lesson-concept {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        /* Scrollbar Styling */
        .chat-history::-webkit-scrollbar,
        .dashboard-panel::-webkit-scrollbar {
            width: 8px;
        }

        .chat-history::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .chat-history::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .dashboard-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .dashboard-panel::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .chat-panel, .dashboard-panel {
                width: 100%;
            }
            .chat-panel {
                height: 60vh;
            }
            .dashboard-panel {
                height: 40vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Panel 1: Chat -->
        <div class="chat-panel">
            <div class="chat-header">
                <div class="chat-header-content">
                    <div class="chat-header-left">
                        <div class="chat-icon">‚òÅÔ∏è</div>
                        <div class="chat-title">
                            <h1>Cloud Technology Instructor</h1>
                            <div class="chat-subtitle">Master AWS, GCP, Azure & more</div>
                        </div>
                    </div>
                    <div id="platformBadge" class="platform-badge"></div>
                </div>
            </div>

            <div id="chatHistory" class="chat-history"></div>

            <div class="quick-actions">
                <div class="quick-actions-buttons">
                    <button class="quick-btn" onclick="handleQuickAction('repeat')">üîÑ Repeat Question</button>
                    <button class="quick-btn" onclick="handleQuickAction('hint')">üí° Give Me a Hint</button>
                    <button id="exampleBtn" class="quick-btn example" onclick="handleQuickAction('example')" style="display: none;">‚ú® Show Example</button>
                    <button id="startOverBtn" class="quick-btn restart" onclick="startOver()" style="display: none; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">üîÑ Start Over</button>
                </div>
            </div>

            <div class="input-area">
                <div class="voice-controls">
                    <button id="ttsToggle" class="voice-toggle active" onclick="toggleTTS()">
                        <span>üîä</span>
                        <span>Instructor Voice: ON</span>
                    </button>
                </div>
                <div class="voice-status" id="voiceStatus">Instructor voice enabled - Type to interact</div>
                
                <div id="speakingIndicator" class="speaking-indicator">
                    <div class="speaking-dot"></div>
                    <span class="speaking-text">üîä Instructor speaking...</span>
                </div>
                
                
                <div class="input-controls">
                    <div class="input-group" style="margin-left: 0;">
                        <input 
                            type="text" 
                            id="textInput" 
                            class="text-input" 
                            placeholder="Type your answer here..."
                            onkeypress="handleKeyPress(event)"
                        >
                        <button class="send-button" onclick="handleSend()">
                            <span>Send</span>
                            <span>üì§</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel 2: Dashboard -->
        <div class="dashboard-panel">
            <div class="dashboard-header">
                <h2>üéØ Learning Dashboard</h2>
                <div class="dashboard-subtitle">Track your cloud mastery journey</div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <span class="card-icon">üìö</span>
                    <span class="card-title">Current Module</span>
                </div>
                <div id="currentLessonDisplay">
                    <div class="current-lesson-title">Welcome to Cloud Learning</div>
                    <div class="current-lesson-concept">Getting Started</div>
                    <div class="current-lesson-desc">Choose your cloud platform journey</div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <span class="card-icon">üé¥</span>
                    <span class="card-title">Concept Flashcard</span>
                    <span class="flashcard-flip-label">(click to flip)</span>
                </div>
                <div id="flashcardContainer" class="flashcard-container" onclick="flipFlashcard()">
                    <div class="flashcard-front">
                        <div class="flashcard-question" id="flashcardQuestion">
                            What is Cloud Computing?
                        </div>
                        <div class="flashcard-hint">üí° Tap card to reveal answer</div>
                    </div>
                    <div class="flashcard-back">
                        <div class="flashcard-answer" id="flashcardAnswer">
                            Cloud computing is the delivery of computing services over the internet, allowing on-demand access to resources without owning physical infrastructure.
                        </div>
                        <div class="flashcard-hint">üí° Tap card to see question</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <span class="card-icon">üìö</span>
                    <span class="card-title">Learning Resources</span>
                </div>
                <div id="resourcesList" class="resources-list">
                    <div class="resource-item">
                        <div class="resource-title">
                            <span>üåê</span>
                            <a href="#" class="resource-link" target="_blank">Getting Started with Cloud</a>
                        </div>
                        <div class="resource-desc">Introduction to cloud computing concepts and benefits</div>
                        <span class="resource-type">BEGINNER</span>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="progress-header">
                    <div class="card-header" style="margin: 0;">
                        <span class="card-icon">üìà</span>
                        <span class="card-title">Progress</span>
                    </div>
                    <span id="progressPercentage" class="progress-percentage">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div id="progressBar" class="progress-bar-fill" style="width: 0%"></div>
                </div>
                <div class="streak-container">
                    <span class="card-icon">‚ö°</span>
                    <span style="font-weight: bold;">Daily Streak:</span>
                    <span id="streakBadge" class="streak-badge">üî• 1 Day</span>
                </div>
            </div>

            <div id="toolsCard" class="dashboard-card" style="display: none;">
                <div class="card-header">
                    <span class="card-icon">üõ†Ô∏è</span>
                    <span class="card-title">Quick Tools Reference</span>
                </div>
                <div id="toolsGrid" class="tools-grid"></div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <span class="card-icon">‚≠ê</span>
                    <span class="card-title">Course Roadmap</span>
                </div>
                <div id="courseMap" class="course-map"></div>
            </div>
        </div>
    </div>

    <script>
        // State Management
        let state = {
            currentLesson: 0,
            currentQuestionIndex: 0,
            chatHistory: [],
            points: 0,
            streak: 1,
            badges: [],
            completedLessons: [],
            selectedPlatform: null,
            platformSelectionMade: false,
            ttsEnabled: true,
            isSpeaking: false
        };

        // Voice Recognition and Synthesis
        let recognition = null; // Voice input disabled
        let synthesis = window.speechSynthesis;
        let currentUtterance = null;
        let finalTranscript = '';
        let interimTranscript = '';
        let iosTTSInitialized = false;
        let iosWelcomeMessagePending = false;

        // Detect iOS
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        // Initialize TTS on iOS with user interaction
        function initIOSTTS() {
            if (isIOS() && !iosTTSInitialized && synthesis) {
                // Prime iOS speech synthesis with empty utterance
                const utterance = new SpeechSynthesisUtterance('');
                utterance.volume = 0;
                synthesis.speak(utterance);
                iosTTSInitialized = true;
                console.log('iOS TTS initialized');
                
                // Speak welcome message if it was pending
                if (iosWelcomeMessagePending && state.chatHistory.length > 0) {
                    const welcomeMessage = state.chatHistory[0];
                    if (welcomeMessage.sender === 'ai') {
                        setTimeout(() => speak(welcomeMessage.message), 500);
                        iosWelcomeMessagePending = false;
                    }
                }
            }
        }

        // Voice recognition disabled - users type only
        function initSpeechRecognition() {
            return false; // Voice input not available
        }

        // Text-to-Speech Function
        function speak(text) {
            if (!state.ttsEnabled || !synthesis || state.isSpeaking) return;

            // Initialize iOS TTS if needed
            if (isIOS() && !iosTTSInitialized) {
                initIOSTTS();
            }

            // Cancel any ongoing speech
            synthesis.cancel();

            // Clean text for speech
            let cleanText = text.replace(/[üéâüí°üî•‚≠ê‚òÅÔ∏èüîµüî∑üöÄüí∞üìà‚ö°üèóÔ∏èüéäüìöüîëüíª‚öôÔ∏èüéØ‚ú®üîíüõ°Ô∏èüì¶üìùüåêüí¨üé§üîä]/g, '');
            cleanText = cleanText.replace(/\n\n/g, '. ');
            cleanText = cleanText.replace(/\n/g, ' ');

            currentUtterance = new SpeechSynthesisUtterance(cleanText);
            currentUtterance.rate = 1.0;
            currentUtterance.pitch = 1.0;
            currentUtterance.volume = 1.0;
            currentUtterance.lang = 'en-US';

            currentUtterance.onstart = function() {
                state.isSpeaking = true;
                document.getElementById('speakingIndicator').classList.add('active');
            };

            currentUtterance.onend = function() {
                state.isSpeaking = false;
                document.getElementById('speakingIndicator').classList.remove('active');
            };

            currentUtterance.onerror = function(event) {
                console.error('Speech synthesis error:', event);
                state.isSpeaking = false;
                document.getElementById('speakingIndicator').classList.remove('active');
                
                // Show iOS-specific message if error occurs
                if (isIOS() && event.error === 'not-allowed') {
                    updateVoiceStatus('üîä iOS requires interaction to enable voice. Tap Send button to activate instructor voice.');
                }
            };

            // iOS requires resuming speech synthesis
            if (isIOS()) {
                synthesis.resume();
            }

            synthesis.speak(currentUtterance);
        }

        // Toggle Functions
        function toggleTTS() {
            state.ttsEnabled = !state.ttsEnabled;
            
            if (state.ttsEnabled) {
                // Initialize iOS TTS when enabling
                if (isIOS() && !iosTTSInitialized) {
                    initIOSTTS();
                }
            } else if (synthesis) {
                synthesis.cancel();
                state.isSpeaking = false;
                document.getElementById('speakingIndicator').classList.remove('active');
            }
            
            updateVoiceToggles();
            updateVoiceStatus();
        }

        function toggleSTT() {
            // Voice input disabled - do nothing
            return;
        }

        function updateVoiceToggles() {
            const ttsToggle = document.getElementById('ttsToggle');

            if (state.ttsEnabled) {
                ttsToggle.classList.add('active');
                ttsToggle.innerHTML = '<span>üîä</span><span>Instructor Voice: ON</span>';
            } else {
                ttsToggle.classList.remove('active');
                ttsToggle.innerHTML = '<span>üîá</span><span>Instructor Voice: OFF</span>';
            }
        }

        function updateVoiceStatus(customMessage) {
            const statusEl = document.getElementById('voiceStatus');
            if (customMessage) {
                statusEl.textContent = customMessage;
                statusEl.style.color = '#dc2626';
            } else if (state.ttsEnabled) {
                statusEl.textContent = 'Instructor voice enabled - Type to interact';
                statusEl.style.color = '#15803d';
            } else {
                statusEl.textContent = 'Instructor voice disabled - Type to interact';
                statusEl.style.color = '#6b7280';
            }
        }

        function updateRecordingUI() {
            // Voice input disabled - do nothing
            return;
        }

        // Lesson Question Banks - 10 questions per lesson
        const lessonQuestions = {
            1: [
                {
                    question: "**Question 1 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat does IaaS stand for?",
                    correctAnswer: "infrastructure as a service",
                    hint: "Think about the foundational layer of cloud services that provides virtual machines and networks...",
                    points: 10
                },
                {
                    question: "**Question 2 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhich service model would you use to deploy a web application without managing operating systems or servers?",
                    correctAnswer: "paas",
                    hint: "Think about the model that provides a platform for development without worrying about infrastructure...",
                    points: 10
                },
                {
                    question: "**Question 3 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat does SaaS stand for?",
                    correctAnswer: "software as a service",
                    hint: "Think about ready-to-use applications delivered over the internet...",
                    points: 10
                },
                {
                    question: "**Question 4 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhich service model gives you the most control over the underlying infrastructure?",
                    correctAnswer: "iaas",
                    hint: "Think about which model lets you manage virtual machines, operating systems, and networks...",
                    points: 10
                },
                {
                    question: "**Question 5 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nGive an example of a SaaS application you might use daily.",
                    correctAnswer: "gmail",
                    alternativeAnswers: ["office 365", "salesforce", "dropbox", "slack", "zoom", "netflix", "crm", "erp", "servicenow", "email service"],
                    hint: "Think about email services, productivity tools, or collaboration platforms...",
                    points: 10
                },
                {
                    question: "**Question 6 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat is one key benefit of cloud computing compared to on-premises infrastructure?",
                    correctAnswer: "scalability",
                    alternativeAnswers: ["flexibility", "cost savings", "elasticity", "pay as you go", "scaling", "cost saving", "cost"],
                    hint: "Think about being able to quickly add or remove resources as needed...",
                    points: 10
                },
                {
                    question: "**Question 7 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nIn which service model does the provider manage everything except your application code and data?",
                    correctAnswer: "paas",
                    hint: "Think about the middle layer where you focus on development, not infrastructure...",
                    points: 10
                },
                {
                    question: "**Question 8 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat does 'pay-as-you-go' mean in cloud computing?",
                    correctAnswer: "pay for what you use",
                    alternativeAnswers: ["pay only when running", "pay based on usage", "no upfront cost"],
                    hint: "Think about how cloud billing works - you're charged based on actual consumption...",
                    points: 10
                },
                {
                    question: "**Question 9 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhich service model is best for a startup that wants to focus on building their app quickly without managing servers?",
                    correctAnswer: "paas",
                    alternativeAnswers: ["platform as a service"],
                    hint: "Think about the model that handles infrastructure so developers can focus on code...",
                    points: 10
                },
                {
                    question: "**Question 10 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nName one major cloud benefit related to disaster recovery.",
                    correctAnswer: "backup",
                    alternativeAnswers: ["redundancy", "replication", "failover", "high availability", "geographic distribution"],
                    hint: "Think about keeping your data safe and available even if something goes wrong...",
                    points: 10
                }
            ],
            5: [
                {
                    question: "**Security Question 1 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat does IAM stand for?",
                    correctAnswer: "identity and access management",
                    hint: "Think about controlling who can access what in your cloud environment...",
                    points: 10
                },
                {
                    question: "**Security Question 2 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nYou're setting up access for a new team member who only needs to view logs. What security principle should you follow?",
                    correctAnswer: "least privilege",
                    alternativeAnswers: ["minimum privilege", "principle of least privilege"],
                    hint: "Think about giving users only the minimum permissions they need...",
                    points: 10
                },
                {
                    question: "**Security Question 3 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat security feature adds an extra layer of authentication beyond just a password?",
                    correctAnswer: "mfa",
                    alternativeAnswers: ["multi-factor authentication", "two factor", "2fa"],
                    hint: "Think about requiring a code from your phone in addition to your password...",
                    points: 10
                },
                {
                    question: "**Security Question 4 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat process protects data so it cannot be read without the proper key?",
                    correctAnswer: "encryption",
                    hint: "Think about scrambling data so only authorized parties can read it...",
                    points: 10
                },
                {
                    question: "**Security Question 5 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nShould you encrypt sensitive data at rest, in transit, or both?",
                    correctAnswer: "both",
                    alternativeAnswers: ["at rest and in transit", "everywhere"],
                    hint: "Think about protecting data when it's stored AND when it's moving between systems...",
                    points: 10
                },
                {
                    question: "**Security Question 6 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat is a security group or firewall used for in cloud networking?",
                    correctAnswer: "control traffic",
                    alternativeAnswers: ["filter traffic", "block unauthorized access", "network security"],
                    hint: "Think about controlling what network traffic can reach your resources...",
                    points: 10
                },
                {
                    question: "**Security Question 7 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat should you regularly do to ensure users still have appropriate access permissions?",
                    correctAnswer: "audit",
                    alternativeAnswers: ["review", "access review", "audit permissions"],
                    hint: "Think about regularly checking and reviewing who has access to what...",
                    points: 10
                },
                {
                    question: "**Security Question 8 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat type of logs should you enable to track user activities and API calls?",
                    correctAnswer: "audit logs",
                    alternativeAnswers: ["activity logs", "cloudtrail", "logging", "monitoring"],
                    hint: "Think about tracking who did what and when in your cloud environment...",
                    points: 10
                },
                {
                    question: "**Security Question 9 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nIn the shared responsibility model, who is responsible for securing the cloud infrastructure (physical security)?",
                    correctAnswer: "cloud provider",
                    alternativeAnswers: ["provider", "aws", "gcp", "azure", "vendor"],
                    hint: "Think about who owns and operates the data centers...",
                    points: 10
                },
                {
                    question: "**Security Question 10 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nIn the shared responsibility model, who is responsible for securing your application code and data?",
                    correctAnswer: "customer",
                    alternativeAnswers: ["you", "user", "client"],
                    hint: "Think about who writes the code and decides what data to store...",
                    points: 10
                }
            ],
            6: [
                {
                    question: "**Database Question 1 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nYour application needs structured data with ACID transactions. Which database type should you use?",
                    correctAnswer: "sql",
                    alternativeAnswers: ["relational", "rdbms"],
                    hint: "Think about traditional databases with tables and strict schemas...",
                    points: 10
                },
                {
                    question: "**Database Question 2 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nYour application stores user profiles with varying fields. Which database type offers the most flexibility?",
                    correctAnswer: "nosql",
                    alternativeAnswers: ["document", "document database"],
                    hint: "Think about databases that don't require a fixed schema...",
                    points: 10
                },
                {
                    question: "**Database Question 3 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat type of database service handles backups, patching, and scaling automatically?",
                    correctAnswer: "managed",
                    alternativeAnswers: ["managed database", "database as a service"],
                    hint: "Think about databases where the cloud provider handles administration...",
                    points: 10
                },
                {
                    question: "**Database Question 4 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nFor analytics on petabytes of data, which database type is best suited?",
                    correctAnswer: "data warehouse",
                    alternativeAnswers: ["warehouse", "analytical database"],
                    hint: "Think about databases optimized for large-scale analysis and reporting...",
                    points: 10
                },
                {
                    question: "**Database Question 5 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nName a popular NoSQL database service from any cloud provider.",
                    correctAnswer: "dynamodb",
                    alternativeAnswers: ["firestore", "cosmos db", "mongodb", "bigtable"],
                    hint: "Think about key-value or document databases from AWS, GCP, or Azure...",
                    points: 10
                }
            ],
            7: [
                {
                    question: "**Networking Question 1 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat does VPC stand for?",
                    correctAnswer: "virtual private cloud",
                    hint: "Think about an isolated network environment in the cloud...",
                    points: 10
                },
                {
                    question: "**Networking Question 2 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nYour website loads slowly for international users. What service caches content globally?",
                    correctAnswer: "cdn",
                    alternativeAnswers: ["content delivery network", "cloudfront", "cloud cdn"],
                    hint: "Think about distributing content to edge locations worldwide...",
                    points: 10
                },
                {
                    question: "**Networking Question 3 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat service distributes incoming traffic across multiple servers?",
                    correctAnswer: "load balancer",
                    alternativeAnswers: ["load balancing", "lb"],
                    hint: "Think about spreading traffic to prevent any single server from being overwhelmed...",
                    points: 10
                },
                {
                    question: "**Networking Question 4 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhich subnet type allows resources to communicate with the internet?",
                    correctAnswer: "public",
                    alternativeAnswers: ["public subnet"],
                    hint: "Think about subnets that have routes to an internet gateway...",
                    points: 10
                },
                {
                    question: "**Networking Question 5 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat security feature controls traffic to and from your cloud resources?",
                    correctAnswer: "security group",
                    alternativeAnswers: ["firewall", "security groups", "network acl"],
                    hint: "Think about virtual firewalls that control inbound and outbound traffic...",
                    points: 10
                }
            ],
            8: [
                {
                    question: "**Monitoring Question 1 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat type of data shows CPU usage, memory consumption, and network traffic?",
                    correctAnswer: "metrics",
                    alternativeAnswers: ["monitoring metrics", "performance metrics"],
                    hint: "Think about numerical measurements of system performance...",
                    points: 10
                },
                {
                    question: "**Monitoring Question 2 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat tool tracks requests across multiple microservices to find bottlenecks?",
                    correctAnswer: "tracing",
                    alternativeAnswers: ["distributed tracing", "trace"],
                    hint: "Think about following a request's journey through your system...",
                    points: 10
                },
                {
                    question: "**Monitoring Question 3 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat feature automatically notifies you when metrics exceed thresholds?",
                    correctAnswer: "alerts",
                    alternativeAnswers: ["alarms", "alerting", "notifications"],
                    hint: "Think about getting notified when something goes wrong...",
                    points: 10
                },
                {
                    question: "**Monitoring Question 4 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat service collects and stores application logs centrally?",
                    correctAnswer: "logging",
                    alternativeAnswers: ["centralized logging", "log management"],
                    hint: "Think about gathering logs from all services in one place...",
                    points: 10
                },
                {
                    question: "**Monitoring Question 5 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nName a monitoring service from any cloud provider.",
                    correctAnswer: "cloudwatch",
                    alternativeAnswers: ["cloud monitoring", "azure monitor", "application insights"],
                    hint: "Think about AWS, GCP, or Azure monitoring services...",
                    points: 10
                }
            ],
            9: [
                {
                    question: "**Cost Optimization Question 1 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat strategy involves matching resource sizes to actual usage needs?",
                    correctAnswer: "right sizing",
                    alternativeAnswers: ["rightsizing", "right-sizing"],
                    hint: "Think about not over-provisioning resources...",
                    points: 10
                },
                {
                    question: "**Cost Optimization Question 2 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhich compute option offers up to 90% savings for interruptible workloads?",
                    correctAnswer: "spot",
                    alternativeAnswers: ["spot instances", "preemptible"],
                    hint: "Think about instances that can be interrupted with short notice...",
                    points: 10
                },
                {
                    question: "**Cost Optimization Question 3 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat commitment provides 30-70% discount for 1-3 year terms?",
                    correctAnswer: "reserved",
                    alternativeAnswers: ["reserved instances", "reservations", "savings plans"],
                    hint: "Think about committing to long-term usage for discounts...",
                    points: 10
                },
                {
                    question: "**Cost Optimization Question 4 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat should you do with unused resources to reduce costs?",
                    correctAnswer: "delete",
                    alternativeAnswers: ["remove", "terminate", "eliminate"],
                    hint: "Think about getting rid of resources you're not using...",
                    points: 10
                },
                {
                    question: "**Cost Optimization Question 5 of 5:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat feature automatically moves old data to cheaper storage classes?",
                    correctAnswer: "lifecycle",
                    alternativeAnswers: ["lifecycle policy", "lifecycle rules"],
                    hint: "Think about policies that transition data based on age...",
                    points: 10
                }
            ]
        };
        // Function to generate platform-specific questions for lessons 2, 3, 4
        function generatePlatformQuestions(lessonId, platform) {
            const platformData = platforms[platform];
            if (!platformData) return [];
            
            if (lessonId === 2) {
                // Storage questions
                const archival = platform === 'aws' ? 'Glacier' : platform === 'gcp' ? 'Coldline' : 'Cool Blob Storage';
                const standard = platform === 'aws' ? 'S3 Standard' : platform === 'gcp' ? 'Standard storage' : 'Hot tier';
                return [
                    {
                        question: `**Storage Question 1 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat is ${platformData.tools.storage.name} used for?`,
                        correctAnswer: "object storage",
                        alternativeAnswers: ["storing files", "storing data", "file storage"],
                        hint: `Think about the primary storage service in ${platform.toUpperCase()}...`,
                        points: 10
                    },
                    {
                        question: `**Storage Question 2 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nYour company needs to store millions of user photos that are rarely accessed but must be kept for compliance. Which ${platform.toUpperCase()} storage class would you recommend?`,
                        correctAnswer: platform === 'aws' ? 'glacier' : platform === 'gcp' ? 'coldline' : 'cool',
                        alternativeAnswers: [archival.toLowerCase()],
                        hint: `Look for the storage class designed for archival or infrequently accessed data in ${platformData.name}...`,
                        points: 10
                    },
                    {
                        question: `**Storage Question 3 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat type of storage is best for frequently accessed data that needs low latency?`,
                        correctAnswer: platform === 'aws' ? 's3 standard' : platform === 'gcp' ? 'standard' : 'hot',
                        alternativeAnswers: [standard.toLowerCase(), "standard storage", "hot tier"],
                        hint: "Think about the highest performance tier for data you access often...",
                        points: 10
                    },
                    {
                        question: `**Storage Question 4 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat is object storage typically measured in?`,
                        correctAnswer: "durability",
                        alternativeAnswers: ["eleven nines", "99.999999999%", "availability"],
                        hint: "Think about how cloud providers describe data resilience (hint: it's often 11 nines)...",
                        points: 10
                    },
                    {
                        question: `**Storage Question 5 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nName one common use case for object storage.`,
                        correctAnswer: "backup",
                        alternativeAnswers: ["website hosting", "static content", "data lake", "media storage", "archival"],
                        hint: "Think about storing files, hosting websites, or keeping backups...",
                        points: 10
                    },
                    {
                        question: `**Storage Question 6 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat feature allows object storage to grow automatically as you add more data?`,
                        correctAnswer: "scalability",
                        alternativeAnswers: ["unlimited capacity", "auto-scaling", "elastic"],
                        hint: "Think about how storage capacity increases without manual intervention...",
                        points: 10
                    },
                    {
                        question: `**Storage Question 7 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat should you consider when choosing a storage class?`,
                        correctAnswer: "cost",
                        alternativeAnswers: ["access frequency", "retrieval time", "performance", "pricing"],
                        hint: "Think about balancing storage costs with how often you need to access the data...",
                        points: 10
                    },
                    {
                        question: `**Storage Question 8 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat feature helps protect against data loss by keeping multiple copies?`,
                        correctAnswer: "replication",
                        alternativeAnswers: ["redundancy", "backup", "duplication"],
                        hint: "Think about keeping copies of your data in multiple locations...",
                        points: 10
                    },
                    {
                        question: `**Storage Question 9 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat should you enable to track who accesses your storage objects?`,
                        correctAnswer: "logging",
                        alternativeAnswers: ["access logs", "audit logs", "monitoring"],
                        hint: "Think about recording access patterns and user activities...",
                        points: 10
                    },
                    {
                        question: `**Storage Question 10 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat process makes stored data unreadable without authorization?`,
                        correctAnswer: "encryption",
                        alternativeAnswers: ["encrypt", "encryption at rest"],
                        hint: "Think about protecting data security even if someone gains physical access...",
                        points: 10
                    }
                ];
            }
            
            if (lessonId === 3) {
                // Compute questions
                return [
                    {
                        question: `**Compute Question 1 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat is ${platformData.tools.compute.name} used for?`,
                        correctAnswer: "virtual machines",
                        alternativeAnswers: ["compute", "servers", "vms", "instances"],
                        hint: `Think about the core compute service in ${platform.toUpperCase()}...`,
                        points: 10
                    },
                    {
                        question: `**Compute Question 2 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nYou need to host a web application that typically handles 100 users but spikes to 10,000 during launches. What ${platform.toUpperCase()} feature should you use?`,
                        correctAnswer: "auto scaling",
                        alternativeAnswers: ["autoscaling", "auto-scaling", "scaling"],
                        hint: "Think about automatically adding or removing compute resources based on demand...",
                        points: 10
                    },
                    {
                        question: `**Compute Question 3 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat type of instance is best for CPU-intensive workloads like video encoding?`,
                        correctAnswer: "compute optimized",
                        alternativeAnswers: ["compute", "cpu optimized"],
                        hint: "Think about instances designed for high-performance computing tasks...",
                        points: 10
                    },
                    {
                        question: `**Compute Question 4 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat type of instance is best for in-memory databases?`,
                        correctAnswer: "memory optimized",
                        alternativeAnswers: ["memory", "ram optimized"],
                        hint: "Think about instances with lots of RAM for data processing in memory...",
                        points: 10
                    },
                    {
                        question: `**Compute Question 5 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nHow do you pay for compute resources in the cloud?`,
                        correctAnswer: "pay for what you use",
                        alternativeAnswers: ["pay as you go", "hourly", "per second", "usage based"],
                        hint: "Think about the cloud pricing model where you're charged based on actual usage...",
                        points: 10
                    },
                    {
                        question: `**Compute Question 6 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat allows you to launch multiple identical instances from a template?`,
                        correctAnswer: "image",
                        alternativeAnswers: ["ami", "machine image", "template", "snapshot"],
                        hint: "Think about a saved configuration you can use to create new instances...",
                        points: 10
                    },
                    {
                        question: `**Compute Question 7 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat should you do with instances you're not using to save costs?`,
                        correctAnswer: "stop",
                        alternativeAnswers: ["shut down", "terminate", "turn off"],
                        hint: "Think about not running (and paying for) idle resources...",
                        points: 10
                    },
                    {
                        question: `**Compute Question 8 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat distributes incoming traffic across multiple instances?`,
                        correctAnswer: "load balancer",
                        alternativeAnswers: ["load balancing", "elb", "alb"],
                        hint: "Think about spreading requests evenly across your compute resources...",
                        points: 10
                    },
                    {
                        question: `**Compute Question 9 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat metric triggers auto scaling to add more instances?`,
                        correctAnswer: "cpu",
                        alternativeAnswers: ["cpu usage", "cpu utilization", "metrics"],
                        hint: "Think about monitoring resource usage like CPU or memory to know when to scale...",
                        points: 10
                    },
                    {
                        question: `**Compute Question 10 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat networking feature controls inbound and outbound traffic to instances?`,
                        correctAnswer: "security group",
                        alternativeAnswers: ["firewall", "network rules", "firewall rules"],
                        hint: "Think about virtual firewalls that control network access...",
                        points: 10
                    }
                ];
            }
            
            if (lessonId === 4) {
                // Serverless questions
                return [
                    {
                        question: `**Serverless Question 1 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat is ${platformData.tools.serverless.name} used for?`,
                        correctAnswer: "serverless functions",
                        alternativeAnswers: ["functions", "code execution", "serverless"],
                        hint: `Think about running code without managing servers in ${platform.toUpperCase()}...`,
                        points: 10
                    },
                    {
                        question: `**Serverless Question 2 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nYour startup needs to process uploaded images but uploads are unpredictable. Why is ${platformData.tools.serverless.name} ideal?`,
                        correctAnswer: "scale",
                        alternativeAnswers: ["auto scaling", "scales automatically", "pay per use"],
                        hint: "Think about automatic scaling and paying only for actual executions...",
                        points: 10
                    },
                    {
                        question: `**Serverless Question 3 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nHow are you charged for serverless functions?`,
                        correctAnswer: "per execution",
                        alternativeAnswers: ["per request", "per invocation", "pay per use"],
                        hint: "Think about paying only when your code actually runs...",
                        points: 10
                    },
                    {
                        question: `**Serverless Question 4 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat triggers a serverless function to run?`,
                        correctAnswer: "event",
                        alternativeAnswers: ["events", "trigger", "request"],
                        hint: "Think about something happening (like a file upload) that starts your code...",
                        points: 10
                    },
                    {
                        question: `**Serverless Question 5 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat do you NOT have to manage with serverless computing?`,
                        correctAnswer: "servers",
                        alternativeAnswers: ["infrastructure", "scaling", "capacity"],
                        hint: "The name gives it away - think about what 'serverless' means...",
                        points: 10
                    },
                    {
                        question: `**Serverless Question 6 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nName a use case perfect for serverless functions.`,
                        correctAnswer: "api",
                        alternativeAnswers: ["api backend", "data processing", "image processing", "webhooks", "scheduled tasks"],
                        hint: "Think about event-driven workloads like APIs, data processing, or scheduled jobs...",
                        points: 10
                    },
                    {
                        question: `**Serverless Question 7 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat happens to serverless functions when not in use?`,
                        correctAnswer: "scale to zero",
                        alternativeAnswers: ["zero cost", "no charge", "idle"],
                        hint: "Think about not paying for idle time when nothing is running...",
                        points: 10
                    },
                    {
                        question: `**Serverless Question 8 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat is typically limited in serverless functions?`,
                        correctAnswer: "execution time",
                        alternativeAnswers: ["timeout", "duration", "runtime"],
                        hint: "Think about functions having maximum run times (often 15 minutes or less)...",
                        points: 10
                    },
                    {
                        question: `**Serverless Question 9 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat programming languages can you typically use for serverless functions?`,
                        correctAnswer: "multiple",
                        alternativeAnswers: ["python", "node", "java", "go", "many", "various"],
                        hint: "Think about platforms supporting multiple popular programming languages...",
                        points: 10
                    },
                    {
                        question: `**Serverless Question 10 of 10:**\n\nPlease study the Learning Resources and answer below question:\n\nWhat aspect of serverless makes it great for unpredictable workloads?`,
                        correctAnswer: "automatic scaling",
                        alternativeAnswers: ["auto-scaling", "elasticity", "scales automatically"],
                        hint: "Think about handling anywhere from zero to thousands of requests automatically...",
                        points: 10
                    }
                ];
            }
            
            return [];
        }

        // Data
        const platforms = {
            aws: {
                name: 'Amazon Web Services (AWS)',
                icon: '‚òÅÔ∏è',
                color: 'aws',
                tools: {
                    compute: { name: 'EC2 (Elastic Compute Cloud)', desc: 'Virtual servers in the cloud' },
                    storage: { name: 'S3 (Simple Storage Service)', desc: 'Scalable object storage' },
                    database: { name: 'RDS (Relational Database Service)', desc: 'Managed relational databases' },
                    serverless: { name: 'Lambda', desc: 'Run code without servers' },
                    networking: { name: 'VPC (Virtual Private Cloud)', desc: 'Isolated cloud resources' }
                }
            },
            gcp: {
                name: 'Google Cloud Platform (GCP)',
                icon: 'üîµ',
                color: 'gcp',
                tools: {
                    compute: { name: 'Compute Engine', desc: 'Virtual machines on Google infrastructure' },
                    storage: { name: 'Cloud Storage', desc: 'Object storage for any data' },
                    database: { name: 'Cloud SQL', desc: 'Fully managed relational databases' },
                    serverless: { name: 'Cloud Functions', desc: 'Event-driven serverless compute' },
                    networking: { name: 'Cloud VPC', desc: 'Global virtual network' }
                }
            },
            azure: {
                name: 'Microsoft Azure',
                icon: 'üî∑',
                color: 'azure',
                tools: {
                    compute: { name: 'Virtual Machines', desc: 'On-demand scalable computing' },
                    storage: { name: 'Blob Storage', desc: 'Massively scalable object storage' },
                    database: { name: 'Azure SQL Database', desc: 'Intelligent managed database' },
                    serverless: { name: 'Azure Functions', desc: 'Serverless compute service' },
                    networking: { name: 'Virtual Network', desc: 'Private network in Azure' }
                }
            }
        };

        const lessons = [
            { id: 0, title: "Welcome to Cloud Learning", concept: "Getting Started", description: "Choose your cloud platform journey" },
            { id: 1, title: "What is Cloud Computing?", concept: "Cloud Fundamentals", description: "Understanding IaaS, PaaS, SaaS, and cloud benefits" },
            { id: 2, title: "Cloud Storage Solutions", concept: "Data Storage in the Cloud", description: "Learn about object storage, block storage, and file systems" },
            { id: 3, title: "Compute Services", concept: "Virtual Machines & Containers", description: "Deploy and manage compute resources" },
            { id: 4, title: "Serverless Computing", concept: "Event-Driven Architecture", description: "Build applications without managing servers" },
            { id: 5, title: "Cloud Security Basics", concept: "Protecting Your Resources", description: "Identity, access management, and encryption" },
            { id: 6, title: "Cloud Databases", concept: "Managed Database Services", description: "Explore SQL, NoSQL, and data warehousing solutions" },
            { id: 7, title: "Cloud Networking", concept: "VPCs, Load Balancers & CDN", description: "Design secure and scalable network architectures" },
            { id: 8, title: "Monitoring & Logging", concept: "Observability & Debugging", description: "Track performance, logs, and application health" },
            { id: 9, title: "Cost Optimization", concept: "Cloud Financial Management", description: "Optimize spending and maximize ROI" }
        ];

        const flashcards = {
            0: {
                question: "Why choose a specific cloud platform?",
                answer: "Different platforms have unique strengths: AWS for breadth, GCP for data/ML, Azure for enterprise. Your choice depends on your use case, existing tools, and team expertise."
            },
            1: {
                question: "What is Cloud Computing?",
                answer: "Cloud computing is the delivery of computing services (servers, storage, databases, networking, software) over the internet, providing faster innovation, flexible resources, and economies of scale."
            },
            2: {
                question: "What is Object Storage?",
                answer: "Object storage manages data as objects (files with metadata) rather than in file hierarchies. It's highly scalable, durable, and perfect for unstructured data like images, videos, and backups."
            },
            3: {
                question: "What is Auto Scaling?",
                answer: "Auto Scaling automatically adjusts compute capacity based on demand. It adds instances during traffic spikes and removes them during quiet times, optimizing both performance and costs."
            },
            4: {
                question: "What is Serverless Computing?",
                answer: "Serverless lets you run code without provisioning servers. You write functions, the platform handles scaling and infrastructure, and you pay only for actual execution time."
            },
            5: {
                question: "What is the Principle of Least Privilege?",
                answer: "Least privilege means granting users only the minimum permissions necessary to perform their job. This security practice reduces the risk of unauthorized access or accidental damage."
            },
            6: {
                question: "What are Managed Database Services?",
                answer: "Managed databases handle administration tasks like backups, patching, and scaling automatically. You focus on your data and queries while the cloud provider manages infrastructure."
            },
            7: {
                question: "What is a Virtual Private Cloud (VPC)?",
                answer: "A VPC is an isolated network in the cloud where you control IP addresses, subnets, and security. It provides secure communication between your cloud resources."
            },
            8: {
                question: "Why is Monitoring Important?",
                answer: "Monitoring tracks application performance, detects issues early, and provides insights for optimization. It helps maintain reliability and improve user experience."
            },
            9: {
                question: "What is Cloud Cost Optimization?",
                answer: "Cost optimization involves right-sizing resources, using reserved instances, eliminating waste, and choosing appropriate storage classes to reduce spending while maintaining performance."
            }
        };

        const learningResources = {
            0: [
                {
                    title: "Cloud Platform Comparison Guide",
                    url: "https://cloud.google.com/docs/compare/aws",
                    description: "Compare AWS, GCP, and Azure services side-by-side",
                    type: "COMPARISON"
                },
                {
                    title: "Choosing a Cloud Provider",
                    url: "https://www.coursera.org/articles/cloud-computing",
                    description: "Factors to consider when selecting your cloud platform",
                    type: "ARTICLE"
                }
            ],
            1: {
                aws: [
                    {
                        title: "AWS Cloud Essentials",
                        url: "https://aws.amazon.com/getting-started/cloud-essentials/",
                        description: "Official AWS guide to cloud fundamentals",
                        type: "GUIDE"
                    },
                    {
                        title: "What is IaaS, PaaS, and SaaS?",
                        url: "https://aws.amazon.com/types-of-cloud-computing/",
                        description: "AWS explanation of cloud service models",
                        type: "ARTICLE"
                    }
                ],
                gcp: [
                    {
                        title: "Google Cloud Fundamentals",
                        url: "https://cloud.google.com/docs/overview",
                        description: "Official GCP overview and core concepts",
                        type: "GUIDE"
                    },
                    {
                        title: "Cloud Computing Concepts",
                        url: "https://cloud.google.com/learn/what-is-cloud-computing",
                        description: "GCP's guide to cloud computing basics",
                        type: "ARTICLE"
                    }
                ],
                azure: [
                    {
                        title: "Azure Fundamentals",
                        url: "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/",
                        description: "Microsoft's cloud adoption framework",
                        type: "GUIDE"
                    },
                    {
                        title: "What is Cloud Computing?",
                        url: "https://azure.microsoft.com/en-us/resources/cloud-computing-dictionary/what-is-cloud-computing",
                        description: "Azure's introduction to cloud concepts",
                        type: "ARTICLE"
                    }
                ]
            },
            2: {
                aws: [
                    {
                        title: "Amazon S3 Getting Started",
                        url: "https://aws.amazon.com/s3/getting-started/",
                        description: "Learn S3 basics and storage classes",
                        type: "TUTORIAL"
                    },
                    {
                        title: "S3 Storage Classes Guide",
                        url: "https://aws.amazon.com/s3/storage-classes/",
                        description: "Choose the right storage class for your needs",
                        type: "GUIDE"
                    }
                ],
                gcp: [
                    {
                        title: "Cloud Storage Documentation",
                        url: "https://cloud.google.com/storage/docs",
                        description: "Official GCP storage documentation",
                        type: "DOCS"
                    },
                    {
                        title: "Storage Classes Overview",
                        url: "https://cloud.google.com/storage/docs/storage-classes",
                        description: "Understand GCP storage tiers and pricing",
                        type: "GUIDE"
                    }
                ],
                azure: [
                    {
                        title: "Azure Blob Storage Tutorial",
                        url: "https://learn.microsoft.com/en-us/azure/storage/blobs/",
                        description: "Get started with Azure Blob Storage",
                        type: "TUTORIAL"
                    },
                    {
                        title: "Storage Access Tiers",
                        url: "https://learn.microsoft.com/en-us/azure/storage/blobs/access-tiers-overview",
                        description: "Hot, Cool, and Archive storage explained",
                        type: "GUIDE"
                    }
                ]
            },
            3: {
                aws: [
                    {
                        title: "Amazon EC2 User Guide",
                        url: "https://docs.aws.amazon.com/ec2/",
                        description: "Complete EC2 documentation and tutorials",
                        type: "DOCS"
                    },
                    {
                        title: "Auto Scaling Guide",
                        url: "https://aws.amazon.com/autoscaling/",
                        description: "Learn to implement automatic scaling",
                        type: "GUIDE"
                    }
                ],
                gcp: [
                    {
                        title: "Compute Engine Quickstart",
                        url: "https://cloud.google.com/compute/docs/quickstart",
                        description: "Launch your first VM on GCP",
                        type: "TUTORIAL"
                    },
                    {
                        title: "Autoscaling VMs",
                        url: "https://cloud.google.com/compute/docs/autoscaler",
                        description: "Configure managed instance groups",
                        type: "GUIDE"
                    }
                ],
                azure: [
                    {
                        title: "Virtual Machines Documentation",
                        url: "https://learn.microsoft.com/en-us/azure/virtual-machines/",
                        description: "Azure VM guides and best practices",
                        type: "DOCS"
                    },
                    {
                        title: "VM Scale Sets Overview",
                        url: "https://learn.microsoft.com/en-us/azure/virtual-machine-scale-sets/",
                        description: "Implement auto-scaling on Azure",
                        type: "GUIDE"
                    }
                ]
            },
            4: {
                aws: [
                    {
                        title: "AWS Lambda Getting Started",
                        url: "https://aws.amazon.com/lambda/getting-started/",
                        description: "Build your first serverless function",
                        type: "TUTORIAL"
                    },
                    {
                        title: "Serverless Architecture",
                        url: "https://aws.amazon.com/serverless/",
                        description: "Learn serverless patterns and best practices",
                        type: "GUIDE"
                    }
                ],
                gcp: [
                    {
                        title: "Cloud Functions Quickstart",
                        url: "https://cloud.google.com/functions/docs/quickstart",
                        description: "Deploy your first Cloud Function",
                        type: "TUTORIAL"
                    },
                    {
                        title: "Serverless on GCP",
                        url: "https://cloud.google.com/serverless",
                        description: "Overview of GCP serverless options",
                        type: "GUIDE"
                    }
                ],
                azure: [
                    {
                        title: "Azure Functions Documentation",
                        url: "https://learn.microsoft.com/en-us/azure/azure-functions/",
                        description: "Complete Azure Functions guide",
                        type: "DOCS"
                    },
                    {
                        title: "Serverless Computing",
                        url: "https://azure.microsoft.com/en-us/solutions/serverless/",
                        description: "Azure serverless architecture overview",
                        type: "GUIDE"
                    }
                ]
            },
            5: {
                aws: [
                    {
                        title: "AWS Security Best Practices",
                        url: "https://aws.amazon.com/architecture/security-identity-compliance/",
                        description: "Learn AWS security fundamentals",
                        type: "GUIDE"
                    },
                    {
                        title: "IAM Tutorial",
                        url: "https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html",
                        description: "Master AWS Identity and Access Management",
                        type: "TUTORIAL"
                    }
                ],
                gcp: [
                    {
                        title: "GCP Security Overview",
                        url: "https://cloud.google.com/security",
                        description: "Understanding GCP security model",
                        type: "GUIDE"
                    },
                    {
                        title: "IAM Overview & Best Practices",
                        url: "https://cloud.google.com/iam/docs/overview",
                        description: "Implement secure access controls with GCP IAM",
                        type: "TUTORIAL"
                    }
                ],
                azure: [
                    {
                        title: "Azure Security Documentation",
                        url: "https://learn.microsoft.com/en-us/azure/security/",
                        description: "Comprehensive Azure security guide",
                        type: "DOCS"
                    },
                    {
                        title: "Azure AD and IAM",
                        url: "https://learn.microsoft.com/en-us/azure/active-directory/",
                        description: "Manage identities and access in Azure",
                        type: "GUIDE"
                    }
                ]
            }
        };

        const badgeDefinitions = [
            { id: 'first-step', name: 'Cloud Explorer', icon: 'üöÄ', condition: (p) => p >= 10 },
            { id: 'cloud-novice', name: 'Cloud Novice', icon: '‚òÅÔ∏è', condition: (p) => p >= 50 },
            { id: 'platform-master', name: 'Platform Master', icon: 'üèÜ', condition: (p) => p >= 100 },
            { id: 'architect', name: 'Cloud Architect', icon: 'üèóÔ∏è', condition: (p) => p >= 150 },
            { id: 'streak-keeper', name: 'Consistent Learner', icon: 'üî•', condition: (p) => state.streak >= 3 }
        ];

        const lessonContent = {
            0: {
                greeting: "Welcome to KN Cloud Learning! I'm your Cloud Technology Instructor, and I'm thrilled to guide you through the exciting world of cloud computing. Whether you're looking to build your first application, migrate existing systems, or become a certified cloud professional, you're in the right place!\n\nüí° STUDY TIP: As you progress through lessons, use the Concept Flashcard to review key terms and explore the Learning Resources section for official documentation and deeper learning!",
                question: "First, let's personalize your learning journey. Which cloud platform are you most interested in exploring?\n\n‚òÅÔ∏è AWS (Amazon Web Services)\nüîµ GCP (Google Cloud Platform)\nüî∑ Azure (Microsoft Azure)\n\nOr type 'all' if you want to learn about multiple platforms!",
                responses: {
                    aws: "Excellent choice! AWS is the world's most comprehensive cloud platform. You'll learn about EC2, S3, Lambda, and more. Let's begin your AWS journey!\n\nüìö Remember to check the Learning Resources section on the right panel - I've curated official AWS documentation and tutorials for each lesson!",
                    gcp: "Great pick! Google Cloud Platform excels in data analytics and machine learning. You'll master Compute Engine, Cloud Storage, BigQuery, and more. Let's get started!\n\nüìö Remember to check the Learning Resources section on the right panel - I've curated official GCP documentation and tutorials for each lesson!",
                    azure: "Fantastic! Microsoft Azure is perfect for enterprise solutions and hybrid cloud. You'll explore Virtual Machines, Blob Storage, Azure Functions, and more. Let's dive in!\n\nüìö Remember to check the Learning Resources section on the right panel - I've curated official Azure documentation and tutorials for each lesson!",
                    all: "Ambitious! Learning multiple platforms will make you incredibly versatile. I'll teach you concepts that apply across AWS, GCP, and Azure. This will be an exciting journey!\n\nüìö Remember to check the Learning Resources section on the right panel - I've curated documentation from all three platforms for each lesson!",
                    default: "I can see you're ready to explore the cloud! Let me know which platform interests you (AWS, GCP, Azure, or 'all'), and we'll customize your learning path.\n\nüí° TIP: Once we start, be sure to use the Concept Flashcard and Learning Resources section to deepen your understanding!"
                }
            },
            1: {
                greeting: "Lesson 1: What is Cloud Computing? Cloud computing delivers computing services over the internet, allowing you to access resources on-demand without owning physical infrastructure.",
                info: "üìö Three Main Service Models:\n\n‚Ä¢ IaaS (Infrastructure as a Service): Virtual machines, storage, networks\n  Example: Running your own server in the cloud\n\n‚Ä¢ PaaS (Platform as a Service): Development platforms without managing infrastructure\n  Example: Hosting a web app without configuring servers\n\n‚Ä¢ SaaS (Software as a Service): Ready-to-use applications\n  Example: Gmail, Office 365, Salesforce\n\n‚òÅÔ∏è Key Benefits: Scalability, cost savings, global reach, and disaster recovery!\n\nüí° TIP: Review the Concept Flashcard and explore the Learning Resources on the right panel for deeper understanding!",
                question: "**Here's your first challenge:**\n\nPlease study the Learning Resources and answer below question:\n\nIf you want to deploy a web application but don't want to manage operating systems or servers, which service model would you use?",
                correctAnswer: "paas",
                responses: {
                    correct: "Perfect! Platform as a Service (PaaS) is exactly right! It lets you focus on your application code while the cloud provider manages the infrastructure. You've earned 20 points! üéâ\n\nüìö Don't forget to review the Learning Resources section for official documentation and deeper learning materials!",
                    hint: "Think about the model that provides a platform for development without worrying about the underlying infrastructure...",
                    wrong: "Good thinking, but not quite. Remember, we're looking for the model where you can deploy apps without managing servers. Would you like a hint?\n\nüí° TIP: Check the Concept Flashcard on the right to review the key concepts!"
                }
            },
            5: {
                greeting: "Lesson 5: Cloud Security Fundamentals. Security in the cloud is a shared responsibility between you and your cloud provider. Understanding this is crucial!",
                info: "üîí Core Security Concepts:\n\n‚Ä¢ Identity & Access Management (IAM): Control who can access what\n‚Ä¢ Encryption: Protect data at rest and in transit\n‚Ä¢ Network Security: Firewalls, security groups, and private networks\n‚Ä¢ Monitoring & Logging: Track activities and detect threats\n\nüõ°Ô∏è Best Practices:\n- Use principle of least privilege\n- Enable multi-factor authentication (MFA)\n- Regularly audit permissions\n- Encrypt sensitive data\n\nüí° TIP: Review the Concept Flashcard and check out the Learning Resources for official security documentation!",
                question: "**Security scenario:**\n\nPlease study the Learning Resources and answer below question:\n\nYou're setting up access for a new team member. They only need to view logs, not modify anything. What security principle should you follow?",
                correctAnswer: "least privilege",
                responses: {
                    correct: "Excellent! The principle of least privilege means giving users only the minimum permissions they need. This reduces security risks. You've earned 30 points and you're now a Cloud Architect! üèóÔ∏èüéâ\n\nüìö Be sure to explore the Learning Resources section for in-depth security best practices and IAM tutorials!",
                    hint: "Think about giving users the minimum access they need to do their job...",
                    wrong: "Good attempt! The key is to give only the necessary permissions, nothing more. Want a hint?\n\nüí° TIP: Check the Concept Flashcard for a quick review of this security principle!"
                }
            },
            6: {
                greeting: "Lesson 6: Cloud Databases. Managed database services eliminate the complexity of database administration, letting you focus on your application logic and data.",
                info: "üóÑÔ∏è Database Types:\n\n‚Ä¢ Relational (SQL): Structured data with ACID transactions\n  Examples: MySQL, PostgreSQL, SQL Server\n\n‚Ä¢ NoSQL: Flexible schemas for unstructured data\n  - Key-Value: Fast lookups (DynamoDB, Redis)\n  - Document: JSON-like data (MongoDB, Firestore)\n  - Wide-Column: Big data analytics (Cassandra, Bigtable)\n\n‚Ä¢ Data Warehouses: Analytics and business intelligence\n  Examples: Redshift, BigQuery, Synapse\n\nüí° TIP: Review the Concept Flashcard and explore database documentation in Learning Resources!",
                question: "**Database scenario:**\n\nPlease study the Learning Resources and answer below question:\n\nYour application needs to store user profiles with varying fields (some users have more data than others). Which database type is most flexible?",
                correctAnswer: "nosql",
                responses: {
                    correct: "Perfect! NoSQL databases like document stores are ideal for flexible schemas where different records can have different fields. That's 25 points! üéØ\n\nüìö Check out the Learning Resources for hands-on database tutorials!",
                    hint: "Think about which database type doesn't require a fixed schema and can handle varying fields...",
                    wrong: "Good thinking! But there's a database type specifically designed for flexible, varying schemas. Want a hint?\n\nüí° TIP: Review the Concept Flashcard on Managed Database Services!"
                }
            },
            7: {
                greeting: "Lesson 7: Cloud Networking. Networking connects your cloud resources securely and efficiently, enabling communication between services and users.",
                info: "üåê Key Networking Concepts:\n\n‚Ä¢ Virtual Private Cloud (VPC): Isolated network environment\n  - Public Subnets: Internet-accessible resources\n  - Private Subnets: Internal resources only\n\n‚Ä¢ Load Balancers: Distribute traffic across servers\n  - Application LB: HTTP/HTTPS traffic\n  - Network LB: TCP/UDP traffic\n\n‚Ä¢ Content Delivery Network (CDN): Cache content globally\n  - Reduces latency for users worldwide\n  - Examples: CloudFront, Cloud CDN, Azure CDN\n\nüîí Security: Firewalls, security groups, network ACLs\n\nüí° TIP: Study the Concept Flashcard and explore networking guides in Learning Resources!",
                question: "**Networking scenario:**\n\nPlease study the Learning Resources and answer below question:\n\nYour website has users worldwide and loads slowly for international visitors. What service can cache your content closer to users?",
                correctAnswer: "cdn",
                responses: {
                    correct: "Excellent! A Content Delivery Network (CDN) caches content at edge locations worldwide, dramatically reducing latency for global users. That's 30 points! üåç\n\nüìö Explore the Learning Resources for CDN implementation guides!",
                    hint: "Think about a service that caches and distributes content from locations around the world...",
                    wrong: "Good attempt! There's a service specifically designed to deliver content faster to users globally. Want a hint?\n\nüí° TIP: Check the Concept Flashcard about VPCs and networking!"
                }
            },
            8: {
                greeting: "Lesson 8: Monitoring & Logging. Observability is crucial for maintaining reliable, performant applications. You can't fix what you can't see!",
                info: "üìä Monitoring & Logging Tools:\n\n‚Ä¢ Metrics & Monitoring:\n  - Track CPU, memory, network usage\n  - Set up alerts for anomalies\n  - Examples: CloudWatch, Cloud Monitoring, Azure Monitor\n\n‚Ä¢ Centralized Logging:\n  - Collect logs from all services\n  - Search and analyze log data\n  - Examples: CloudWatch Logs, Cloud Logging, Log Analytics\n\n‚Ä¢ Distributed Tracing:\n  - Track requests across microservices\n  - Identify bottlenecks and failures\n  - Examples: X-Ray, Cloud Trace, Application Insights\n\n‚ö° Benefits: Faster debugging, proactive issue detection, performance optimization\n\nüí° TIP: Review the Concept Flashcard and explore monitoring documentation in Learning Resources!",
                question: "**Monitoring scenario:**\n\nPlease study the Learning Resources and answer below question:\n\nYour API response times suddenly increased. What type of observability tool helps you track requests across multiple microservices to find the bottleneck?",
                correctAnswer: "tracing",
                responses: {
                    correct: "Perfect! Distributed tracing tracks requests across all services, showing you exactly where delays occur in your microservices architecture. That's 30 points! üîç\n\nüìö Check out the Learning Resources for hands-on monitoring tutorials!",
                    hint: "Think about the tool that follows a request's journey through multiple services...",
                    wrong: "Good thinking! But there's a specific observability tool for tracking requests across microservices. Want a hint?\n\nüí° TIP: Review the Concept Flashcard about monitoring importance!"
                }
            },
            9: {
                greeting: "Lesson 9: Cost Optimization. Cloud costs can spiral out of control without proper management. Let's learn how to maximize value while minimizing spend!",
                info: "üí∞ Cost Optimization Strategies:\n\n‚Ä¢ Right-Sizing: Match resource size to actual needs\n  - Don't overprovision 'just in case'\n  - Use monitoring data to optimize\n\n‚Ä¢ Reserved Instances & Savings Plans:\n  - Commit to 1-3 years for 30-70% discount\n  - Great for predictable workloads\n\n‚Ä¢ Spot Instances: Up to 90% savings\n  - Use for fault-tolerant, flexible workloads\n  - Can be interrupted with short notice\n\n‚Ä¢ Storage Optimization:\n  - Use lifecycle policies to archive old data\n  - Choose appropriate storage classes\n\n‚Ä¢ Eliminate Waste:\n  - Delete unused resources\n  - Stop dev/test environments when not in use\n\nüí° TIP: Study the Concept Flashcard and explore cost management guides in Learning Resources!",
                question: "**Cost optimization scenario:**\n\nPlease study the Learning Resources and answer below question:\n\nYou have a batch processing job that runs nightly and can tolerate interruptions. Which compute option offers the biggest cost savings?",
                correctAnswer: "spot",
                responses: {
                    correct: "Excellent! Spot instances (or equivalent) offer up to 90% savings for workloads that can handle interruptions. You've completed all lessons and mastered cloud computing! üéìüéâ\n\nüèÜ Congratulations! You're now equipped with comprehensive cloud knowledge. Explore the Learning Resources for continuous learning, and use the Start Over button if you want to study another platform!",
                    hint: "Think about the compute option designed for fault-tolerant workloads that offers the steepest discounts...",
                    wrong: "Good attempt! There's a compute option specifically for interruptible workloads that offers massive savings. Want a hint?\n\nüí° TIP: Review the Concept Flashcard about cost optimization!"
                }
            }
        };

        // Initialize
        function init() {
            // Initialize speech recognition
            const hasSTT = initSpeechRecognition();
            const hasTTS = 'speechSynthesis' in window;

            if (!hasSTT) {
                state.sttEnabled = false;
            }

            if (!hasTTS) {
                state.ttsEnabled = false;
            }

            // Show appropriate status message
            if (state.ttsEnabled) {
                if (isIOS()) {
                    updateVoiceStatus('üì± iOS detected: Instructor voice will activate when you send your first message. Type "skip" or "next" to skip questions.');
                    // Mark welcome message as pending for iOS
                    iosWelcomeMessagePending = true;
                } else {
                    updateVoiceStatus('‚úÖ Instructor voice enabled! Type to interact. Type "skip" or "next" to skip questions.');
                }
            } else if (!hasTTS) {
                updateVoiceStatus('Instructor voice not supported. Type to interact. Type "skip" or "next" to skip questions.');
            } else {
                updateVoiceStatus('Instructor voice disabled. Type to interact. Type "skip" or "next" to skip questions.');
            }

            updateVoiceToggles();
            updateFlashcard();
            updateResources();
            updateCourseMap();
            addMessage('ai', lessonContent[0].greeting + '\n\n' + lessonContent[0].question);
        }

        // Flashcard Functions
        function flipFlashcard() {
            const container = document.getElementById('flashcardContainer');
            container.classList.toggle('flipped');
        }

        function updateFlashcard() {
            const flashcard = flashcards[state.currentLesson];
            if (!flashcard) return;

            document.getElementById('flashcardQuestion').textContent = flashcard.question;
            document.getElementById('flashcardAnswer').textContent = flashcard.answer;
            
            // Reset to front
            const container = document.getElementById('flashcardContainer');
            container.classList.remove('flipped');
        }

        // Resources Functions
        function updateResources() {
            const resources = learningResources[state.currentLesson];
            const resourcesList = document.getElementById('resourcesList');
            
            if (!resources) {
                resourcesList.innerHTML = '<div class="resource-item"><div class="resource-desc" style="color: rgba(255,255,255,0.7);">Resources will appear as you progress through lessons.</div></div>';
                return;
            }

            let resourcesToShow = resources;
            
            // If lesson has platform-specific resources and platform is selected
            if (typeof resources === 'object' && !Array.isArray(resources) && state.selectedPlatform && state.selectedPlatform !== 'all') {
                resourcesToShow = resources[state.selectedPlatform] || [];
            }
            
            // If it's the welcome lesson or "all" platform, show general resources
            if (Array.isArray(resources)) {
                resourcesToShow = resources;
            }

            if (!resourcesToShow || resourcesToShow.length === 0) {
                resourcesList.innerHTML = '<div class="resource-item"><div class="resource-desc" style="color: rgba(255,255,255,0.7);">Select a platform to see specific resources.</div></div>';
                return;
            }

            resourcesList.innerHTML = resourcesToShow.map(resource => `
                <div class="resource-item">
                    <div class="resource-title">
                        <span>üîó</span>
                        <a href="${resource.url}" class="resource-link" target="_blank" rel="noopener noreferrer">${resource.title}</a>
                    </div>
                    <div class="resource-desc">${resource.description}</div>
                    <span class="resource-type">${resource.type}</span>
                </div>
            `).join('');
        }

        // Message Functions
        function addMessage(sender, message) {
            const timestamp = new Date();
            state.chatHistory.push({ sender, message, timestamp });
            renderMessages();
            scrollToBottom();

            // Auto-speak AI messages
            if (sender === 'ai' && state.ttsEnabled) {
                setTimeout(() => speak(message), 300);
            }
        }

        function renderMessages() {
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML = state.chatHistory.map(chat => {
                // Convert markdown bold (**text**) to HTML bold
                let formattedMessage = chat.message.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
                // Convert newlines to br tags
                formattedMessage = formattedMessage.replace(/\n/g, '<br>');
                
                return `
                    <div class="message ${chat.sender}">
                        <div class="message-content">
                            ${formattedMessage}
                            <span class="message-time">
                                ${chat.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function scrollToBottom() {
            const chatHistory = document.getElementById('chatHistory');
            setTimeout(() => {
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }, 100);
        }

        // Start Over Function
        function startOver() {
            const confirmMsg = 'üîÑ Start Over?\n\nThis will reset all progress and let you choose a different cloud platform to study.\n\nYour current progress:\n‚Ä¢ Platform: ' + 
                (state.selectedPlatform ? platforms[state.selectedPlatform]?.name || state.selectedPlatform.toUpperCase() : 'Not selected') + 
                '\n‚Ä¢ Points: ' + state.points + 
                '\n‚Ä¢ Lessons completed: ' + state.completedLessons.length + 
                '\n\nAre you sure?';
            
            if (confirm(confirmMsg)) {
                // Reset all state
                state.currentLesson = 0;
                state.currentQuestionIndex = 0;
                state.chatHistory = [];
                state.points = 0;
                state.streak = 1;
                state.badges = [];
                state.completedLessons = [];
                state.selectedPlatform = null;
                state.platformSelectionMade = false;
                
                // Clear chat
                renderMessages();
                
                // Reset platform badge
                document.getElementById('platformBadge').className = 'platform-badge';
                document.getElementById('platformBadge').textContent = '';
                
                // Hide tools and example button
                document.getElementById('toolsCard').style.display = 'none';
                document.getElementById('exampleBtn').style.display = 'none';
                
                // Reset dashboard
                updateCurrentLesson();
                updateFlashcard();
                updateResources();
                updateCourseMap();
                
                // Welcome message
                addMessage('ai', lessonContent[0].greeting + '\n\n' + lessonContent[0].question);
                
                // Scroll to top
                scrollToBottom();
            }
        }

        // Input Handlers
        function handleMicClick() {
            // Voice input disabled - do nothing
            return;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                handleSend();
            }
        }

        function handleSend() {
            const input = document.getElementById('textInput');
            const userInput = input.value.trim();
            
            if (!userInput) return;

            // Initialize iOS TTS on first user interaction
            if (isIOS() && !iosTTSInitialized) {
                initIOSTTS();
            }

            // Stop any ongoing speech
            if (synthesis) {
                synthesis.cancel();
                state.isSpeaking = false;
                document.getElementById('speakingIndicator').classList.remove('active');
            }
            
            addMessage('user', userInput);
            input.value = '';
            
            // Platform selection logic
            if (state.currentLesson === 0 && !state.platformSelectionMade) {
                const platform = handlePlatformSelection(userInput);
                
                if (platform) {
                    state.selectedPlatform = platform;
                    state.platformSelectionMade = true;
                    
                    setTimeout(() => {
                        const responseKey = platform === 'all' ? 'all' : platform;
                        addMessage('ai', lessonContent[0].responses[responseKey]);
                        
                        if (platform !== 'all') {
                            updatePlatformDisplay();
                        }
                        
                        setTimeout(() => {
                            state.currentLesson = 1;
                            state.currentQuestionIndex = 0;
                            addPoints(10);
                            const nextLesson = lessonContent[1];
                            addMessage('ai', `${nextLesson.greeting}\n\n${nextLesson.info}`);
                            
                            // Show first question from question bank
                            setTimeout(() => {
                                const firstQuestion = getCurrentQuestion(1, 0);
                                if (firstQuestion) {
                                    addMessage('ai', firstQuestion.question);
                                }
                            }, 1500);
                            
                            updateCurrentLesson();
                            updateCourseMap();
                        }, 1500);
                    }, 500);
                } else {
                    setTimeout(() => {
                        addMessage('ai', lessonContent[0].responses.default);
                    }, 500);
                }
                return;
            }
            
            // Regular lesson flow
            if (state.currentLesson > 0) {
                // Check for skip/next commands
                const inputLower = userInput.toLowerCase().trim();
                if (inputLower === 'skip' || inputLower === 'next') {
                    const currentQuestion = getCurrentQuestion(state.currentLesson, state.currentQuestionIndex);
                    
                    if (currentQuestion) {
                        setTimeout(() => {
                            const totalQuestions = getTotalQuestionsForLesson(state.currentLesson);
                            const questionProgress = `(Question ${state.currentQuestionIndex + 1}/${totalQuestions})`;
                            
                            // Show the correct answer
                            let correctAnswerText = currentQuestion.correctAnswer;
                            if (currentQuestion.alternativeAnswers && currentQuestion.alternativeAnswers.length > 0) {
                                correctAnswerText += ` (or: ${currentQuestion.alternativeAnswers.slice(0, 2).join(', ')})`;
                            }
                            
                            addMessage('ai', `‚è≠Ô∏è Skipped! ${questionProgress}\n\n‚úÖ The correct answer was: **${correctAnswerText}**\n\nüí° TIP: Review the Concept Flashcard and Learning Resources to learn this concept!`);
                            
                            // Move to next question
                            setTimeout(() => {
                                if (state.currentQuestionIndex < totalQuestions - 1) {
                                    // Move to next question in same lesson
                                    state.currentQuestionIndex++;
                                    updateCurrentLesson();
                                    const nextQuestion = getCurrentQuestion(state.currentLesson, state.currentQuestionIndex);
                                    if (nextQuestion) {
                                        addMessage('ai', nextQuestion.question);
                                    }
                                } else {
                                    // Move to next lesson
                                    state.completedLessons.push(state.currentLesson);
                                    state.currentQuestionIndex = 0;
                                    
                                    if (state.currentLesson < lessons.length - 1) {
                                        state.currentLesson++;
                                        const nextContent = generatePlatformSpecificContent(state.currentLesson, state.selectedPlatform);
                                        
                                        if (state.currentLesson >= 2 && state.currentLesson <= 4) {
                                            addMessage('ai', `${nextContent.greeting}\n\n${nextContent.info}`);
                                            setTimeout(() => {
                                                const firstQuestion = getCurrentQuestion(state.currentLesson, 0);
                                                if (firstQuestion) {
                                                    addMessage('ai', firstQuestion.question);
                                                }
                                            }, 1500);
                                        } else if (state.currentLesson >= 5 && state.currentLesson <= 9) {
                                            addMessage('ai', `${lessonContent[state.currentLesson].greeting}\n\n${lessonContent[state.currentLesson].info}`);
                                            setTimeout(() => {
                                                const firstQuestion = getCurrentQuestion(state.currentLesson, 0);
                                                if (firstQuestion) {
                                                    addMessage('ai', firstQuestion.question);
                                                }
                                            }, 1500);
                                        }
                                        
                                        updateCurrentLesson();
                                        updateCourseMap();
                                        showExampleButton();
                                    } else {
                                        // Course complete
                                        const platformName = state.selectedPlatform === 'all' ? 'multi-cloud' : 
                                                           platforms[state.selectedPlatform]?.name || 'cloud';
                                        addMessage('ai', `üéä Congratulations! You've completed the Cloud Fundamentals course with ${state.points} points! You have a strong foundation in ${platformName} concepts. Keep building, deploying, and scaling in the cloud! Your journey has just begun! üöÄ‚òÅÔ∏è`);
                                        updateCourseMap();
                                        
                                        // Show Start Over button
                                        document.getElementById('startOverBtn').style.display = 'inline-block';
                                    }
                                }
                            }, 1500);
                        }, 500);
                    }
                    return;
                }
                
                const currentQuestion = getCurrentQuestion(state.currentLesson, state.currentQuestionIndex);
                const result = checkAnswer(userInput, state.currentLesson, state.currentQuestionIndex);
                
                if (result === 'correct') {
                    const pointsEarned = currentQuestion ? currentQuestion.points : 10;
                    
                    setTimeout(() => {
                        const totalQuestions = getTotalQuestionsForLesson(state.currentLesson);
                        const questionProgress = `(Question ${state.currentQuestionIndex + 1}/${totalQuestions})`;
                        
                        addMessage('ai', `‚úÖ Correct! Great job! +${pointsEarned} points ${questionProgress}\n\nüìö Keep studying the Learning Resources for deeper understanding!`);
                        addPoints(pointsEarned);
                        
                        // Check if more questions in current lesson
                        if (state.currentQuestionIndex < totalQuestions - 1) {
                            // Move to next question in same lesson
                            setTimeout(() => {
                                state.currentQuestionIndex++;
                                updateCurrentLesson(); // Update question progress display
                                const nextQuestion = getCurrentQuestion(state.currentLesson, state.currentQuestionIndex);
                                if (nextQuestion) {
                                    addMessage('ai', nextQuestion.question);
                                }
                            }, 1500);
                        } else {
                            // Completed all questions in lesson, move to next lesson
                            setTimeout(() => {
                                state.completedLessons.push(state.currentLesson);
                                state.currentQuestionIndex = 0; // Reset for next lesson
                                
                                if (state.currentLesson < lessons.length - 1) {
                                    state.currentLesson++;
                                    const nextContent = generatePlatformSpecificContent(state.currentLesson, state.selectedPlatform);
                                    
                                    // For lessons with question banks, show greeting and first question
                                    if (state.currentLesson >= 2 && state.currentLesson <= 4) {
                                        addMessage('ai', `${nextContent.greeting}\n\n${nextContent.info}`);
                                        setTimeout(() => {
                                            const firstQuestion = getCurrentQuestion(state.currentLesson, 0);
                                            if (firstQuestion) {
                                                addMessage('ai', firstQuestion.question);
                                            }
                                        }, 1500);
                                    } else if (state.currentLesson >= 5 && state.currentLesson <= 9) {
                                        // Lessons 5-9 (Security, Databases, Networking, Monitoring, Cost Optimization)
                                        addMessage('ai', `${lessonContent[state.currentLesson].greeting}\n\n${lessonContent[state.currentLesson].info}`);
                                        setTimeout(() => {
                                            const firstQuestion = getCurrentQuestion(state.currentLesson, 0);
                                            if (firstQuestion) {
                                                addMessage('ai', firstQuestion.question);
                                            }
                                        }, 1500);
                                    }
                                    
                                    updateCurrentLesson();
                                    updateCourseMap();
                                    showExampleButton();
                                } else {
                                    // Course complete!
                                    const platformName = state.selectedPlatform === 'all' ? 'multi-cloud' : 
                                                       platforms[state.selectedPlatform]?.name || 'cloud';
                                    addMessage('ai', `üéä Congratulations! You've completed the Cloud Fundamentals course with ${state.points} points! You have a strong foundation in ${platformName} concepts. Keep building, deploying, and scaling in the cloud! Your journey has just begun! üöÄ‚òÅÔ∏è`);
                                    updateCourseMap();
                                    
                                    // Show Start Over button now that all lessons are complete
                                    document.getElementById('startOverBtn').style.display = 'inline-block';
                                }
                            }, 2000);
                        }
                    }, 500);
                } else {
                    // Wrong answer
                    setTimeout(() => {
                        addMessage('ai', `Not quite. Think about it and try again! üí°\n\nHint: ${currentQuestion.hint}\n\nüìö TIP: Check the Concept Flashcard and Learning Resources for help!`);
                    }, 500);
                }
                return;
            }
        }

        function handlePlatformSelection(input) {
            const inputLower = input.toLowerCase();
            
            if (inputLower.includes('aws') || inputLower.includes('amazon')) {
                return 'aws';
            } else if (inputLower.includes('gcp') || inputLower.includes('google')) {
                return 'gcp';
            } else if (inputLower.includes('azure') || inputLower.includes('microsoft')) {
                return 'azure';
            } else if (inputLower.includes('all') || inputLower.includes('multiple')) {
                return 'all';
            }
            
            return null;
        }

        function checkAnswer(input, lessonId, questionIndex) {
            // Get the current question
            let currentQuestion;
            if (lessonId === 1 || (lessonId >= 5 && lessonId <= 9)) {
                currentQuestion = lessonQuestions[lessonId][questionIndex];
            } else if (lessonId >= 2 && lessonId <= 4) {
                const platformQuestions = generatePlatformQuestions(lessonId, state.selectedPlatform);
                currentQuestion = platformQuestions[questionIndex];
            }
            
            if (!currentQuestion) return 'wrong';
            
            const inputLower = input.toLowerCase().trim();
            
            // Check main correct answer
            if (inputLower.includes(currentQuestion.correctAnswer.toLowerCase())) {
                return 'correct';
            }
            
            // Check alternative answers if they exist
            if (currentQuestion.alternativeAnswers) {
                for (const alt of currentQuestion.alternativeAnswers) {
                    if (inputLower.includes(alt.toLowerCase())) {
                        return 'correct';
                    }
                }
            }
            
            return 'wrong';
        }

        function getCurrentQuestion(lessonId, questionIndex) {
            if (lessonId === 0) return null; // Platform selection
            
            if (lessonId === 1 || (lessonId >= 5 && lessonId <= 9)) {
                return lessonQuestions[lessonId][questionIndex];
            } else if (lessonId >= 2 && lessonId <= 4) {
                const platformQuestions = generatePlatformQuestions(lessonId, state.selectedPlatform);
                return platformQuestions[questionIndex];
            }
            
            return null;
        }

        function getTotalQuestionsForLesson(lessonId) {
            if (lessonId === 0) return 0; // Platform selection has no questions
            if (lessonId === 1 || (lessonId >= 5 && lessonId <= 9)) {
                return lessonQuestions[lessonId].length;
            } else if (lessonId >= 2 && lessonId <= 4) {
                const platformQuestions = generatePlatformQuestions(lessonId, state.selectedPlatform);
                return platformQuestions.length;
            }
            return 0;
        }

        function generatePlatformSpecificContent(lessonId, platform) {
            if (!platform || lessonId < 2) return lessonContent[lessonId];
            
            const platformData = platforms[platform];
            if (!platformData) return lessonContent[lessonId];
            
            if (lessonId === 2) {
                return {
                    greeting: `Lesson 2: Cloud Storage with ${platformData.name}. Storage is fundamental to any cloud application. Let's explore how ${platform.toUpperCase()} handles data storage!`,
                    info: `üì¶ ${platformData.tools.storage.name}:\n${platformData.tools.storage.desc}\n\nüîë Key Features:\n‚Ä¢ Unlimited scalability\n‚Ä¢ 99.999999999% (11 nines) durability\n‚Ä¢ Multiple storage classes for cost optimization\n‚Ä¢ Built-in security and compliance\n\nüí° Common Use Cases:\n- Website hosting and static content\n- Backup and disaster recovery\n- Data lakes for analytics\n- Application data storage\n\n${platform === 'aws' ? 'üìù Example: Creating an S3 bucket to host a static website' : platform === 'gcp' ? 'üìù Example: Using Cloud Storage for video streaming' : 'üìù Example: Storing user uploads in Blob Storage'}\n\nüí° TIP: Review the Concept Flashcard and explore the Learning Resources for ${platformData.name} storage documentation!`,
                    question: `**Real-world scenario:**\n\nPlease study the Learning Resources and answer below question:\n\nYour company needs to store millions of user photos that are rarely accessed but must be kept for compliance. Which ${platform.toUpperCase()} storage approach would you recommend for cost optimization?`,
                    correctAnswer: platform === 'aws' ? 'glacier' : platform === 'gcp' ? 'coldline' : 'cool',
                    responses: {
                        correct: `Brilliant! ${platform === 'aws' ? 'S3 Glacier' : platform === 'gcp' ? 'Coldline storage' : 'Cool Blob Storage'} is perfect for archival data - much cheaper than standard storage for rarely accessed files. That's 25 points for smart cost optimization! üí∞\n\nüìö Check out the Learning Resources section for detailed guides on storage classes and pricing!`,
                        hint: `Look for the storage class designed for archival or infrequently accessed data in ${platformData.name}...`,
                        wrong: "Good thinking about storage! But for rarely accessed archival data, there's a more cost-effective option. Want a hint?\n\nüí° TIP: Review the Concept Flashcard to understand object storage better!"
                    }
                };
            }
            
            if (lessonId === 3) {
                return {
                    greeting: `Lesson 3: Compute Services with ${platformData.name}. Compute power is the engine of the cloud. Let's learn how to deploy virtual machines and containers!`,
                    info: `üíª ${platformData.tools.compute.name}:\n${platformData.tools.compute.desc}\n\n‚öôÔ∏è What You Can Do:\n‚Ä¢ Launch virtual machines in minutes\n‚Ä¢ Choose from hundreds of instance types\n‚Ä¢ Auto-scale based on demand\n‚Ä¢ Pay only for what you use\n\nüéØ Instance Types:\n- General Purpose: Balanced compute, memory, networking\n- Compute Optimized: High-performance processors\n- Memory Optimized: Large datasets in memory\n- Storage Optimized: High disk throughput\n\n${platform === 'aws' ? 'üìù Example: Launching an EC2 t3.micro for a web server' : platform === 'gcp' ? 'üìù Example: Creating a Compute Engine e2-micro VM' : 'üìù Example: Deploying a B1s Virtual Machine for development'}\n\nüí° TIP: Check the Concept Flashcard for Auto Scaling definition, then explore Learning Resources for hands-on tutorials!`,
                    question: `**Performance scenario:**\n\nPlease study the Learning Resources and answer below question:\n\nYou need to host a web application that typically handles 100 users but spikes to 10,000 during product launches. What ${platform.toUpperCase()} feature should you use?`,
                    correctAnswer: 'auto scaling',
                    responses: {
                        correct: `Perfect! Auto Scaling (or Autoscaling) automatically adjusts capacity to maintain performance and minimize costs. During spikes, it adds instances; during quiet times, it scales down. That's 30 points! üìà\n\nüìö The Learning Resources section has detailed guides on implementing auto-scaling for ${platformData.name}!`,
                        hint: "Think about a feature that automatically adds or removes compute resources based on demand...",
                        wrong: "Good thought! But there's a feature that automatically handles these traffic spikes. Would you like a hint?\n\nüí° TIP: Review the Concept Flashcard to understand Auto Scaling!"
                    }
                };
            }
            
            if (lessonId === 4) {
                return {
                    greeting: `Lesson 4: Serverless Computing with ${platformData.name}. Serverless doesn't mean "no servers" - it means you don't manage them! Let's explore this game-changing approach.`,
                    info: `‚ö° ${platformData.tools.serverless.name}:\n${platformData.tools.serverless.desc}\n\n‚ú® Serverless Benefits:\n‚Ä¢ No server management\n‚Ä¢ Automatic scaling from zero to thousands\n‚Ä¢ Pay per execution (not per hour)\n‚Ä¢ Built-in high availability\n\nüéØ Perfect For:\n- API backends\n- Data processing pipelines\n- Scheduled tasks (cron jobs)\n- Event-driven workflows\n- Image/video processing\n\n${platform === 'aws' ? 'üìù Example: Lambda function triggered by S3 upload to resize images' : platform === 'gcp' ? 'üìù Example: Cloud Function processing Pub/Sub messages' : 'üìù Example: Azure Function triggered by blob storage'}\n\nüí° TIP: Review the Concept Flashcard on Serverless, then dive into the Learning Resources for practical tutorials!`,
                    question: `**Business scenario:**\n\nPlease study the Learning Resources and answer below question:\n\nYour startup needs to process uploaded images (resize, compress) but uploads are unpredictable - sometimes 10/day, sometimes 1000/hour. Why is ${platformData.tools.serverless.name} ideal for this?`,
                    correctAnswer: 'scale',
                    responses: {
                        correct: `Exactly! Serverless scales automatically from zero to thousands, and you only pay for actual executions - perfect for unpredictable workloads! That's 30 points! ‚ö°\n\nüìö Explore the Learning Resources section for ${platformData.name} serverless architecture patterns and best practices!`,
                        hint: "Think about how serverless handles variable workloads and what you pay for...",
                        wrong: "You're on the right track! Consider the automatic scaling and pay-per-use nature of serverless. Want a hint?\n\nüí° TIP: Check the Concept Flashcard to understand Serverless Computing better!"
                    }
                };
            }
            
            return lessonContent[lessonId];
        }

        function handleQuickAction(action) {
            if (state.currentLesson === 0) return;
            
            const currentQuestion = getCurrentQuestion(state.currentLesson, state.currentQuestionIndex);
            
            if (action === 'hint' && currentQuestion?.hint) {
                addMessage('ai', `üí° Hint: ${currentQuestion.hint}`);
            } else if (action === 'repeat' && currentQuestion?.question) {
                addMessage('ai', currentQuestion.question);
            } else if (action === 'example' && state.currentLesson > 1 && state.selectedPlatform) {
                const platformData = platforms[state.selectedPlatform];
                if (state.currentLesson === 2) {
                    addMessage('ai', `üí° Example Use Case: A photo-sharing app uses ${platformData.tools.storage.name} to store user uploads. When a user uploads a photo, it's automatically stored with encryption and can be accessed globally via CDN for fast loading.`);
                } else if (state.currentLesson === 3) {
                    addMessage('ai', `üí° Example Use Case: An e-commerce site runs on ${platformData.tools.compute.name}. During Black Friday, traffic increases 10x, and auto-scaling automatically adds more instances to handle the load.`);
                } else if (state.currentLesson === 4) {
                    addMessage('ai', `üí° Example Use Case: A ride-sharing app uses ${platformData.tools.serverless.name} to process driver location updates. Functions scale automatically from hundreds to thousands of concurrent executions during rush hour, with zero management overhead.`);
                }
            }
        }

        // Points and Tracking
        function addPoints(points) {
            state.points += points;
            // Points tracked but not displayed prominently
        }

        // UI Updates
        function updateCurrentLesson() {
            const lesson = lessons[state.currentLesson];
            
            // Show question progress if in a lesson with questions
            let progressText = '';
            if (state.currentLesson > 0) {
                const totalQuestions = getTotalQuestionsForLesson(state.currentLesson);
                if (totalQuestions > 0) {
                    progressText = ` - Question ${state.currentQuestionIndex + 1}/${totalQuestions}`;
                }
            }
            
            document.getElementById('currentLessonDisplay').innerHTML = `
                <div class="current-lesson-title">${lesson.title}${progressText}</div>
                <div class="current-lesson-concept">${lesson.concept}</div>
                <div class="current-lesson-desc">${lesson.description}</div>
            `;
            
            // Calculate overall course progress
            const progress = ((state.currentLesson + 1) / lessons.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressPercentage').textContent = `${Math.round(progress)}%`;
            
            // Update flashcard and resources for new lesson
            updateFlashcard();
            updateResources();
        }

        function updatePlatformDisplay() {
            const platformBadge = document.getElementById('platformBadge');
            const toolsCard = document.getElementById('toolsCard');
            
            if (state.selectedPlatform && state.selectedPlatform !== 'all') {
                const platform = platforms[state.selectedPlatform];
                
                platformBadge.textContent = `${platform.icon} ${platform.name}`;
                platformBadge.className = `platform-badge ${platform.color} active`;
                
                toolsCard.style.display = 'block';
                document.getElementById('toolsGrid').innerHTML = Object.values(platform.tools).map(tool => `
                    <div class="tool-item">
                        <div class="tool-name">${tool.name}</div>
                        <div class="tool-desc">${tool.desc}</div>
                    </div>
                `).join('');
            }
        }

        function showExampleButton() {
            if (state.currentLesson > 1 && state.selectedPlatform) {
                document.getElementById('exampleBtn').style.display = 'block';
            }
        }

        function updateCourseMap() {
            const courseMap = document.getElementById('courseMap');
            courseMap.innerHTML = lessons.map((lesson, index) => {
                let status = 'locked';
                let number = index + 1;
                
                if (index === state.currentLesson) {
                    status = 'current';
                } else if (state.completedLessons.includes(index)) {
                    status = 'completed';
                    number = '‚úì';
                }
                
                return `
                    <div class="lesson-item ${status}">
                        <div class="lesson-content">
                            <div class="lesson-number">${number}</div>
                            <div class="lesson-info">
                                <div class="lesson-title">${lesson.title}</div>
                                <div class="lesson-concept">${lesson.concept}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
